import{d as L,r as b,o as N,a as M,c as T,j as m,C as h,w as p,a9 as _,at as R,f as S,F as Y,ay as U,b0 as D,aN as V,aO as A}from"./index-79c64a0f.js";import{u as O}from"./index-ad814812.js";import{_ as P}from"./_plugin-vue_export-helper-c27b6911.js";const j=l=>(V("data-v-0be163dc"),l=l(),A(),l),x={class:"canvas-dom"},W=j(()=>m("h3",null,"基于canvas实现的签名组件",-1)),q=["onMousemove","onTouchmove"],z=["src"],G=L({__name:"signature",setup(l){const i=b(""),a=b();let u,r=!1;const v=e=>{let t;if(e.offsetX){const{offsetX:o,offsetY:s}=e;t=[o,s]}else{const{top:o,left:s}=a.value.getBoundingClientRect(),n=e.touches[0].clientX-s,c=e.touches[0].clientY-o;t=[n,c]}return t};let d=0,f=0;const g=e=>{[d,f]=v(e),r=!0},w=e=>{if(r){const[t,o]=v(e);I(d,f,t,o,u),d=t,f=o}},y=()=>{r&&(r=!1)};N(()=>{u=a.value.getContext("2d")});const B=async()=>{if(C(a.value)){U({type:"warning",message:"当前签名文件为空"});return}const e=F(a.value.toDataURL(),"签名.png");if(!e)return;const{data:t}=await O(e);k(),i.value=t.url},k=()=>{u.clearRect(0,0,a.value.width,a.value.height)},C=e=>{const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.toDataURL()==t.toDataURL()},X=()=>{if(C(a.value)){U({type:"warning",message:"当前签名文件为空"});return}const e=document.createElement("a");e.href=a.value.toDataURL(),e.download="签名";const t=new MouseEvent("click");e.dispatchEvent(t)},F=(e,t)=>{const o=e.split(",");if(!o.length)return;const s=o[0].match(/:(.*?);/);if(s&&!s.length){const n=atob(o[1]);let c=n.length;const E=new Uint8Array(c);for(;c--;)E[c]=n.charCodeAt(c);return new File([E],t,{type:s[0]})}};function I(e,t,o,s,n){n.beginPath(),n.globalAlpha=1,n.lineWidth=2,n.strokeStyle="#000",n.moveTo(e,t),n.lineTo(o,s),n.closePath(),n.stroke()}return(e,t)=>{const o=D;return M(),T("div",x,[W,m("header",null,[h(o,{type:"primary",onClick:X},{default:p(()=>[_("保存为图片")]),_:1}),h(o,{onClick:B},{default:p(()=>[_(" 保存到后端 ")]),_:1}),h(o,{onClick:k},{default:p(()=>[_(" 清空签名 ")]),_:1})]),m("canvas",{ref_key:"canvas",ref:a,height:"200",width:"500",onMousedown:g,onMousemove:R(w,["stop","prevent"]),onMouseup:y,onTouchstart:g,onTouchmove:R(w,["stop","prevent"]),onTouchend:y},null,40,q),S(i)?(M(),T("img",{key:0,src:S(i),alt:"签名"},null,8,z)):Y("",!0)])}}});const Q=P(G,[["__scopeId","data-v-0be163dc"]]);export{Q as default};
