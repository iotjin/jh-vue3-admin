import{c as T,b as Q,h as De,v as xe,D as Se,F as Ce,G as Re,w as ke,u as Ne,H as Oe,g as Je,I as Te,J as Ee}from"./element-plus-afa9f445.js";import{_ as Ie}from"./index-1e92d896.js";import{d as Me,r as Ye,$ as U,a0 as $,i as Ae,ao as Be,o as S,c as W,a as m,X as r,Q as c,u as i,af as X,F as Ve,ab as Fe,P as k,l as L,V as N,R as y,W as E,a2 as Pe,S as Ue,Y as $e,bh as Le,bf as qe}from"./@vue-7d0fc2b4.js";import{g as ze,A as Ke}from"./addDialog-3bc72a2c.js";import{g as Z,d as je,r as He}from"./user-ab2f02fa.js";import Ge from"./assignRoleDialog-1e071d0f.js";import{u as q,w as Qe}from"./xlsx-f5126985.js";import{_ as We}from"./plugin-vueexport-helper-c27b6911.js";import"./lodash-es-d29772ce.js";import"./async-validator-dee29e8b.js";import"./@vueuse-d1e6df39.js";import"./dayjs-78f57161.js";import"./@intlify-999e9484.js";import"./source-map-7d7e1c08.js";import"./@element-plus-975622b8.js";import"./@ctrl-f8748455.js";import"./@sxzz-c75af06c.js";import"./escape-html-bdfaebd7.js";import"./normalize-wheel-es-ed76fb12.js";import"./dict-94a4b541.js";import"./index-980e0a7f.js";import"./pinia-4649f5ad.js";import"./vue-demi-71ba0ef2.js";import"./vue-router-98b533fa.js";import"./axios-4a70c6fc.js";import"./vue-i18n-625cf0a6.js";import"./vue-ff9293da.js";import"./js-cookie-edb2da2a.js";import"./nprogress-941844a1.js";import"./mockjs-3c670f17.js";import"./vite-plugin-mock-8bbc2346.js";import"./path-to-regexp-36ea9d8d.js";import"./role-d784477d.js";const Xe={Jh_timeStampToTime:K,Jh_convertTimeStamp:z,Jh_timestampToYMD:Ze,Jh_isToday:et,Jh_getYearMonth:tt,Jh_getPrevYear:at,Jh_getNextYear:nt,Jh_getPrevYearMonth:lt,Jh_getNextYearMonth:ot,Jh_compareTimes:pt,Jh_isBetweenTimes:dt,Jh_isBetweenTimesByCurrent:ct,Jh_isBetweenTimesByCurrentAndEndTime:ut,getEndTime:st,startOfDay:rt,endOfDay:it},Y=Xe;function K(a,e){if(arguments.length===0)return null;const t=e||"{y}-{m}-{d} {h}:{i}:{s}";let s;typeof a=="object"?console.log():((""+a).length===10&&(a=parseInt(a)*1e3),s=new Date(a));const d={y:s.getFullYear(),m:s.getMonth()+1,d:s.getDate(),h:s.getHours(),i:s.getMinutes(),s:s.getSeconds(),w:s.getDay()};return t.replace(/{(y|m|d|h|i|s|w)+}/g,(u,g)=>{let p=d[g];return g==="w"?["日","一","二","三","四","五","六"][p]:(u.length>0&&p<10&&(p="0"+p),p||0)})}function z(a){let e=a.replace(/-|\./g,"/");return e=e.replace(/年/g,"/"),e=e.replace(/月/g,"/"),e=e.replace(/日/g,""),e.length===4&&(e=e+"/01/01 00:00:00"),e.length===7&&(e=e+"/01 00:00:00"),e.length===10&&(e=e+" 00:00:00"),e.length===16&&(e=e+":00"),Date.parse(e)}function Ze(a,e){var t=["Y","M","D","h","m","s"],s=[],d=new Date(parseInt(a)),w=d.getFullYear(),u=d.getMonth()+1,g=d.getDate(),p=d.getHours(),f=d.getMinutes(),C=d.getSeconds();s.push(w),s.push(u<10?"0"+u:u),s.push(g<10?"0"+g:g),s.push(p<10?"0"+p:p),s.push(f<10?"0"+f:f),s.push(C<10?"0"+C:C);for(var O in s)e=e.replace(t[O],s[O]);return e}function et(a){let e=a.replace(/-/g,"");e=e.substring(0,8);var t=new Date().getTime();return t=K(t,"{y}{m}{d}"),e===t}function tt(){const a=Date.parse(new Date);return K(a,"{y}-{m}")}function at(a){let e=a.substring(0,4);e=parseInt(e),e=e-1;const t=a.substring(4,5);let s="";return t==="年"?s=e+"年":s=e+t,s}function nt(a){let e=a.substring(0,4);e=parseInt(e),e=e+1;const t=a.substring(4,5);let s="";return t==="年"?s=e+"年":s=e+t,s}function lt(a){let e=a.substring(0,4),t=a.substring(5,7);e=parseInt(e),t=parseInt(t),t=t-1,t===0&&(e=e-1,t=12),t<10&&(t="0"+t);const s=a.substring(4,5);let d="";return s==="年"?d=e+"年"+t+"月":d=e+s+t,d}function ot(a){let e=a.substring(0,4),t=a.substring(5,7);e=parseInt(e),t=parseInt(t),t=t+1,t===13&&(e=e+1,t=1),t<10&&(t="0"+t);const s=a.substring(4,5);let d="";return s==="年"?d=e+"年"+t+"月":d=e+s+t,d}function st(a){var e=new Date(a).getFullYear(),t=new Date(a).getMonth()+1,s=new Date(a).getDate(),d=new Date,w=new Date(new Date(a).toLocaleDateString()),u=w.getTime()-d.getTime(),g=parseInt(u/1e3),p=Math.floor(g/(60*60*24)),f=Math.floor((g-p*24*60*60)/3600),C=Math.floor((g-p*24*60*60-f*3600)/60),O=Math.floor(g-p*60*60*24-f*60*60-C*60);return`距离${e}年${t}月${s}日还有${p}天${f}小时${C}分${O}秒`}function rt(a){return a?a.substr(0,10)+" 00:00:00":""}function it(a){return a?a.substr(0,10)+" 23:59:59":""}function dt(a,e,t){return a=a.replace(/-/g,"/"),e=e.replace(/-/g,"/"),t=t.replace(/-/g,"/"),a=new Date(a),e=new Date(e),t=new Date(t),e<=a&&a<=t}function ct(a,e){a=a.replace(/-/g,"/"),e=e.replace(/-/g,"/"),a=new Date(a),e=new Date(e);const t=new Date;return a<=t&&t<=e}function ut(a,e){const t=new Date;return a=a.replace(/-/g,"/"),e=e.replace(/-/g,"/"),a=new Date(a),e=new Date(e),t<=a&&a<=e}function pt(a,e){const t=z(a),s=z(e);return t>s}function gt(a,e,t=[],s="Excel.xlsx",d="Sheet"){let w=new Array;if(!Array.isArray(a))return console.warn("dataList is not an array type");w=a.map(p=>e.map(f=>p[f])),t.length>0?w.splice(0,0,t):w.splice(0,0,e);const u=q.aoa_to_sheet(w),g=q.book_new();q.book_append_sheet(g,u,d),Qe(g,s)}const A=a=>(Le("data-v-b04062c2"),a=a(),qe(),a),mt={class:"bs-page-body"},ft=A(()=>m("span",{class:"bs-form-label",style:{width:"80px"}},[m("span",{class:"icon"},"姓名:")],-1)),ht=A(()=>m("span",{class:"bs-form-label"},[m("span",{class:"icon"},"员工编号:")],-1)),_t=A(()=>m("span",{class:"bs-form-label",style:{width:"80px"}},[m("span",{class:"icon"},"部门:")],-1)),bt=A(()=>m("span",{class:"bs-form-label",style:{width:"100px"}},[m("span",{class:"icon"},"创建时间:")],-1)),wt={class:"bs-page-table"},yt={class:"bs-table-btns"},vt=["onClick"],Dt={style:{color:"#00a0e9","text-decoration":"underline"}},xt={class:"bs-tooltip-text"},St=Me({__name:"index",setup(a){const e=Ye(),t=U({tableTotal:0,tableLoading:!1,tableData:[],queryParams:{page:1,limit:10,startDate:"",endDate:"",name:"",userNumber:"",deptId:""},dateRange:[],selectedRows:[]}),{tableTotal:s,tableLoading:d,tableData:w,queryParams:u,dateRange:g,selectedRows:p}=$(t),f=U({deptOptions:[],levelOptions:[]}),{deptOptions:C,levelOptions:O}=$(f),h=U({isShowDialog:!1,dialogType:"add",dialogFormData:{},isShowDialogAssignRole:!1,assignRoleUserData:{}}),{isShowDialog:B,dialogType:ee,dialogFormData:te,isShowDialogAssignRole:V,assignRoleUserData:ae}=$(h);Ae(()=>{ne(),J()});const ne=()=>{ze().then(n=>{n.code===2e4?(f.deptOptions=n.data.dept,f.levelOptions=n.data.level):T.warning(n.msg)})},J=()=>{var n=JSON.parse(JSON.stringify(t.queryParams));n.startDate=t.dateRange?Y.startOfDay(t.dateRange[0]):"",n.endDate=t.dateRange?Y.endOfDay(t.dateRange[1]):"",console.log(JSON.stringify(n)),t.tableLoading=!0,Z(n).then(l=>{t.tableLoading=!1,l.code===2e4?(t.tableData=l.data,t.tableTotal=l.total):T.warning(l.msg)}).catch(l=>{t.tableLoading=!1,console.log(JSON.stringify(l))})},F=()=>{t.queryParams.page=1,J()},I=n=>!n.loginName.toLowerCase().includes("admin"),le=n=>{t.selectedRows=n},M=(n,l)=>{const _=l.findIndex(v=>v.value===n);if(_!==-1)return l[_].label},oe=n=>n.status==="0"?"#E6A23C":"#67C23A",se=()=>{h.dialogType="add",h.dialogFormData={},h.isShowDialog=!0},j=n=>{const l=JSON.parse(JSON.stringify(n&&n.id?n:t.selectedRows[0]));h.dialogType="edit",h.dialogFormData=l,h.isShowDialog=!0},re=n=>{const l=JSON.parse(JSON.stringify(n&&n.id?n:t.selectedRows[0]));h.dialogType="look",h.dialogFormData=l,h.isShowDialog=!0},H=n=>{var l="";n&&n.id?l=n.name:l=t.selectedRows.map(_=>_.name).join(","),Q.confirm(`确定要删除用户 ${l} ，此操作将永久删除, 是否继续?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var _={ids:[]};if(n&&n.id)_.ids=[n.id];else{const v=t.selectedRows.map(D=>D.id);_.ids=v}ie(_)})},ie=n=>{je(n).then(l=>{l.code===2e4?(T.success("删除成功!"),J()):T.warning(l.msg)})},de=()=>{if(t.selectedRows.length===0){var n=JSON.parse(JSON.stringify(t.queryParams));n.startDate=t.dateRange?Y.startOfDay(t.dateRange[0]):"",n.endDate=t.dateRange?Y.endOfDay(t.dateRange[1]):"",n.page=0,n.limit=1e3,console.log(JSON.stringify(n)),Z(n).then(l=>{const{data:_}=l;G(_)})}else G(t.selectedRows)},G=n=>{var l=n;l.forEach(D=>{D.deptName=M(D.deptId,f.deptOptions),D.statusText=D.status==="0"?"停用":"启用",D.levelName=M(D.level,f.levelOptions)}),gt(l,["name","loginName","userNumber","deptName","statusText","userExpiryDate","levelName","notes","phone"],["姓名","用户名","员工编号","部门","状态","用户有效期至","级别","备注","手机号"],"用户数据.xlsx")},ce=()=>{h.assignRoleUserData=JSON.parse(JSON.stringify(t.selectedRows[0])),h.isShowDialogAssignRole=!0},ue=n=>{h.dialogType="look",h.dialogFormData=JSON.parse(JSON.stringify(n)),h.isShowDialog=!0},pe=n=>{Q.confirm(`确定要重置 ${n.name} 的密码, 是否继续 ?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const l={id:n.id};ge(l)})},ge=n=>{console.log(JSON.stringify(n)),He(n).then(l=>{l.code===2e4?(T.success("重置密码成功!"),J()):T.warning(l.msg)})},me=()=>{e.value.clearSelection()};return(n,l)=>{const _=De,v=xe,D=Se,fe=Ce,he=Re,x=ke,_e=Ne,b=Oe,be=Je,we=Te,ye=Ie,R=Be("hasPerm"),ve=Ee;return S(),W("div",null,[m("div",mt,[r(_e,{inline:!0,model:i(u),class:"bs-form-search mt10"},{default:c(()=>[r(v,null,{default:c(()=>[ft,r(_,{modelValue:i(u).name,"onUpdate:modelValue":l[0]||(l[0]=o=>i(u).name=o),maxlength:"20",placeholder:"请输入姓名",clearable:"",onKeyup:X(F,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1}),r(v,null,{default:c(()=>[ht,r(_,{modelValue:i(u).userNumber,"onUpdate:modelValue":l[1]||(l[1]=o=>i(u).userNumber=o),maxlength:"20",placeholder:"请输入员工编号",clearable:"",onKeyup:X(F,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1}),r(v,null,{default:c(()=>[_t,r(fe,{modelValue:i(u).deptId,"onUpdate:modelValue":l[2]||(l[2]=o=>i(u).deptId=o),placeholder:"请选择",filterable:"",clearable:""},{default:c(()=>[(S(!0),W(Ve,null,Fe(i(C),o=>(S(),k(D,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(v,null,{default:c(()=>[bt,r(he,{modelValue:i(g),"onUpdate:modelValue":l[3]||(l[3]=o=>L(g)?g.value=o:null),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",format:"YYYY年MM月DD日"},null,8,["modelValue"])]),_:1}),r(v,null,{default:c(()=>[r(x,{class:"bs-form-btn",type:"primary",onClick:F},{default:c(()=>[N("查询")]),_:1})]),_:1})]),_:1},8,["model"]),m("div",wt,[m("div",yt,[y((S(),k(x,{type:"primary",icon:"i-ep-plus",onClick:se},{default:c(()=>[N(" 新增 ")]),_:1})),[[R,["user-add"]]]),y((S(),k(x,{type:"primary",icon:"i-ep-edit",disabled:i(p).length!==1,onClick:j},{default:c(()=>[N(" 编辑 ")]),_:1},8,["disabled"])),[[R,["user-edit"]]]),y((S(),k(x,{type:"primary",icon:"i-ep-search",disabled:i(p).length!==1,onClick:re},{default:c(()=>[N(" 查看 ")]),_:1},8,["disabled"])),[[R,["user-look"]]]),y((S(),k(x,{type:"warning",icon:"i-ep-download",onClick:de},{default:c(()=>[N(" 导出 ")]),_:1})),[[R,["user-export"]]]),y((S(),k(x,{type:"danger",icon:"i-ep-delete",disabled:i(p).length==0,onClick:H},{default:c(()=>[N(" 删除 ")]),_:1},8,["disabled"])),[[R,["user-delete"]]]),y((S(),k(x,{type:"warning",icon:"i-ep-setting",disabled:i(p).length!==1,onClick:ce},{default:c(()=>[N(" 角色分配 ")]),_:1},8,["disabled"])),[[R,["user-assign"]]])]),y((S(),k(we,{ref_key:"tableRef",ref:e,class:"bs-table",data:i(w),stripe:!0,"header-cell-style":{textAlign:"center"},"cell-style":{textAlign:"center"},onSelectionChange:le},{default:c(()=>[r(b,{prop:"number",type:"index",label:"序号","min-width":"60"}),r(b,{type:"selection",width:"55",selectable:I}),r(b,{label:"姓名","min-width":"100"},{default:c(o=>[m("span",{onClick:P=>ue(o.row)},[m("a",Dt,E(o.row.name),1)],8,vt)]),_:1}),r(b,{prop:"loginName",label:"用户名","min-width":"120"}),r(b,{prop:"userNumber",label:"员工编号","min-width":"120",sortable:""}),r(b,{label:"部门","min-width":"130"},{default:c(o=>[m("div",null,E(M(o.row.deptId,i(C))),1)]),_:1}),r(b,{label:"状态"},{default:c(o=>[m("div",{style:Pe({background:oe(o.row)}),class:"tagClass"},E(o.row.status==="0"?"停用":"启用"),5)]),_:1}),r(b,{prop:"userExpiryDate",label:"用户有效期至",sortable:"","min-width":"140"}),r(b,{label:"级别","min-width":"100"},{default:c(o=>[m("div",{class:Ue(o.row.level=="1"?"b-tag-success":o.row.level=="2"?"b-tag-warning":"b-tag-error")},E(M(o.row.level,i(O))),3)]),_:1}),r(b,{prop:"phone",label:"手机号","min-width":"120"}),r(b,{label:"备注","min-width":"100"},{default:c(o=>[r(be,{"visible-arrow":!1,effect:"light",content:o.row.notes,placement:"bottom"},{default:c(()=>[m("span",xt,E(o.row.notes),1)]),_:2},1032,["content"])]),_:1}),r(b,{fixed:"right",label:"操作",width:"180"},{default:c(o=>[y(r(x,{size:"small",icon:"i-ep-edit",disabled:!I(o.row),onClick:P=>j(o.row)},null,8,["disabled","onClick"]),[[R,["user-edit"]]]),y(r(x,{size:"small",icon:"i-ep-delete",type:"danger",disabled:!I(o.row),onClick:P=>H(o.row)},null,8,["disabled","onClick"]),[[R,["user-delete"]]]),y(r(x,{size:"small",icon:"i-ep-refresh-left",type:"danger",disabled:!I(o.row),onClick:P=>pe(o.row)},null,8,["disabled","onClick"]),[[R,["user-resetPwd"]]])]),_:1})]),_:1},8,["data"])),[[ve,i(d)]]),y(r(ye,{total:i(s),page:i(u).page,"onUpdate:page":l[4]||(l[4]=o=>i(u).page=o),limit:i(u).limit,"onUpdate:limit":l[5]||(l[5]=o=>i(u).limit=o),onPagination:J},null,8,["total","page","limit"]),[[$e,i(s)>0]])]),r(Ke,{"dialog-type":i(ee),"is-show":i(B),"onUpdate:isShow":l[6]||(l[6]=o=>L(B)?B.value=o:null),"dialog-data":i(te),onSuccess:J,onClosed:me},null,8,["dialog-type","is-show","dialog-data"]),r(Ge,{"is-show":i(V),"onUpdate:isShow":l[7]||(l[7]=o=>L(V)?V.value=o:null),"dialog-data":i(ae)},null,8,["is-show","dialog-data"])])])}}});const la=We(St,[["__scopeId","data-v-b04062c2"]]);export{la as default};
