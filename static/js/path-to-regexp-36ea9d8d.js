function D(r){for(var a=[],e=0;e<r.length;){var f=r[e];if(f==="*"||f==="+"||f==="?"){a.push({type:"MODIFIER",index:e,value:r[e++]});continue}if(f==="\\"){a.push({type:"ESCAPED_CHAR",index:e++,value:r[e++]});continue}if(f==="{"){a.push({type:"OPEN",index:e,value:r[e++]});continue}if(f==="}"){a.push({type:"CLOSE",index:e,value:r[e++]});continue}if(f===":"){for(var d="",n=e+1;n<r.length;){var v=r.charCodeAt(n);if(v>=48&&v<=57||v>=65&&v<=90||v>=97&&v<=122||v===95){d+=r[n++];continue}break}if(!d)throw new TypeError("Missing parameter name at ".concat(e));a.push({type:"NAME",index:e,value:d}),e=n;continue}if(f==="("){var x=1,u="",n=e+1;if(r[n]==="?")throw new TypeError('Pattern cannot start with "?" at '.concat(n));for(;n<r.length;){if(r[n]==="\\"){u+=r[n++]+r[n++];continue}if(r[n]===")"){if(x--,x===0){n++;break}}else if(r[n]==="("&&(x++,r[n+1]!=="?"))throw new TypeError("Capturing groups are not allowed at ".concat(n));u+=r[n++]}if(x)throw new TypeError("Unbalanced pattern at ".concat(e));if(!u)throw new TypeError("Missing pattern at ".concat(e));a.push({type:"PATTERN",index:e,value:u}),e=n;continue}a.push({type:"CHAR",index:e,value:r[e++]})}return a.push({type:"END",index:e,value:""}),a}function O(r,a){a===void 0&&(a={});for(var e=D(r),f=a.prefixes,d=f===void 0?"./":f,n="[^".concat(T(a.delimiter||"/#?"),"]+?"),v=[],x=0,u=0,p="",c=function(g){if(u<e.length&&e[u].type===g)return e[u++].value},i=function(g){var s=c(g);if(s!==void 0)return s;var R=e[u],b=R.type,N=R.index;throw new TypeError("Unexpected ".concat(b," at ").concat(N,", expected ").concat(g))},E=function(){for(var g="",s;s=c("CHAR")||c("ESCAPED_CHAR");)g+=s;return g};u<e.length;){var m=c("CHAR"),w=c("NAME"),h=c("PATTERN");if(w||h){var o=m||"";d.indexOf(o)===-1&&(p+=o,o=""),p&&(v.push(p),p=""),v.push({name:w||x++,prefix:o,suffix:"",pattern:h||n,modifier:c("MODIFIER")||""});continue}var l=m||c("ESCAPED_CHAR");if(l){p+=l;continue}p&&(v.push(p),p="");var A=c("OPEN");if(A){var o=E(),C=c("NAME")||"",t=c("PATTERN")||"",y=E();i("CLOSE"),v.push({name:C||(t?x++:""),pattern:C&&!t?n:t,prefix:o,suffix:y,modifier:c("MODIFIER")||""});continue}i("END")}return v}function $(r,a){return M(O(r,a),a)}function M(r,a){a===void 0&&(a={});var e=P(a),f=a.encode,d=f===void 0?function(u){return u}:f,n=a.validate,v=n===void 0?!0:n,x=r.map(function(u){if(typeof u=="object")return new RegExp("^(?:".concat(u.pattern,")$"),e)});return function(u){for(var p="",c=0;c<r.length;c++){var i=r[c];if(typeof i=="string"){p+=i;continue}var E=u?u[i.name]:void 0,m=i.modifier==="?"||i.modifier==="*",w=i.modifier==="*"||i.modifier==="+";if(Array.isArray(E)){if(!w)throw new TypeError('Expected "'.concat(i.name,'" to not repeat, but got an array'));if(E.length===0){if(m)continue;throw new TypeError('Expected "'.concat(i.name,'" to not be empty'))}for(var h=0;h<E.length;h++){var o=d(E[h],i);if(v&&!x[c].test(o))throw new TypeError('Expected all "'.concat(i.name,'" to match "').concat(i.pattern,'", but got "').concat(o,'"'));p+=i.prefix+o+i.suffix}continue}if(typeof E=="string"||typeof E=="number"){var o=d(String(E),i);if(v&&!x[c].test(o))throw new TypeError('Expected "'.concat(i.name,'" to match "').concat(i.pattern,'", but got "').concat(o,'"'));p+=i.prefix+o+i.suffix;continue}if(!m){var l=w?"an array":"a string";throw new TypeError('Expected "'.concat(i.name,'" to be ').concat(l))}}return p}}function T(r){return r.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function P(r){return r&&r.sensitive?"":"i"}function S(r,a){if(!a)return r;for(var e=/\((?:\?<(.*?)>)?(?!\?)/g,f=0,d=e.exec(r.source);d;)a.push({name:d[1]||f++,prefix:"",suffix:"",modifier:"",pattern:""}),d=e.exec(r.source);return r}function _(r,a,e){var f=r.map(function(d){return F(d,a,e).source});return new RegExp("(?:".concat(f.join("|"),")"),P(e))}function H(r,a,e){return I(O(r,e),a,e)}function I(r,a,e){e===void 0&&(e={});for(var f=e.strict,d=f===void 0?!1:f,n=e.start,v=n===void 0?!0:n,x=e.end,u=x===void 0?!0:x,p=e.encode,c=p===void 0?function(N){return N}:p,i=e.delimiter,E=i===void 0?"/#?":i,m=e.endsWith,w=m===void 0?"":m,h="[".concat(T(w),"]|$"),o="[".concat(T(E),"]"),l=v?"^":"",A=0,C=r;A<C.length;A++){var t=C[A];if(typeof t=="string")l+=T(c(t));else{var y=T(c(t.prefix)),g=T(c(t.suffix));if(t.pattern)if(a&&a.push(t),y||g)if(t.modifier==="+"||t.modifier==="*"){var s=t.modifier==="*"?"?":"";l+="(?:".concat(y,"((?:").concat(t.pattern,")(?:").concat(g).concat(y,"(?:").concat(t.pattern,"))*)").concat(g,")").concat(s)}else l+="(?:".concat(y,"(").concat(t.pattern,")").concat(g,")").concat(t.modifier);else t.modifier==="+"||t.modifier==="*"?l+="((?:".concat(t.pattern,")").concat(t.modifier,")"):l+="(".concat(t.pattern,")").concat(t.modifier);else l+="(?:".concat(y).concat(g,")").concat(t.modifier)}}if(u)d||(l+="".concat(o,"?")),l+=e.endsWith?"(?=".concat(h,")"):"$";else{var R=r[r.length-1],b=typeof R=="string"?o.indexOf(R[R.length-1])>-1:R===void 0;d||(l+="(?:".concat(o,"(?=").concat(h,"))?")),b||(l+="(?=".concat(o,"|").concat(h,")"))}return new RegExp(l,P(e))}function F(r,a,e){return r instanceof RegExp?S(r,a):Array.isArray(r)?_(r,a,e):H(r,a,e)}export{$ as c,F as p};
