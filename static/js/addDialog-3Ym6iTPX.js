import{b as f,a as $,c as se,I as pe,k as me,w as ue,F as ce,G as ge,H as fe,J as he,v as be,d as _e,K as we}from"./element-plus-Bdn4kiSG.js";import{g as De}from"./base-io3ORlSv.js";import{c as ye,e as xe}from"./tables-0F8w5F2k.js";import{T as E}from"./timeUtils-CwNtu00v.js";import{d as ve,r as R,_ as x,$ as B,w as _,f as Se,o as w,c as k,W as l,P as n,a as T,U as v,u as i,Q as Ve,O as Y,F as ke,ab as Te,T as Oe,l as Ce,h as N}from"./@vue-DBL8Ibom.js";import{_ as $e}from"./index-DFeBoV3U.js";import"./lodash-es-Blijzk1b.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-BThtamsc.js";import"./dayjs-C6J0yRL_.js";import"./@intlify-CHY6szXs.js";import"./@sxzz-D9SI2xQl.js";import"./@element-plus-BmjHI8io.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./dict-BYyJu2Xi.js";import"./pinia-7g9vQp6f.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-fhvlCfPF.js";import"./crypto-js-CYDAzdEe.js";import"./axios-CCb-kr4I.js";import"./js-cookie-Cz0CWeBA.js";import"./vue-i18n-B8qYdFXi.js";import"./vue-rTnkxsfK.js";import"./vue-draggable-plus-BSvTyIk2.js";import"./nprogress-yi2QV7xY.js";import"./mockjs-DsSR4jwH.js";import"./vite-plugin-mock-CDJiH8Qs.js";import"./path-to-regexp-BzK_ZY7n.js";const Ee={class:"bs-dialog input-width"},Re={class:"bs-page-table"},Be={class:"bs-table-btns"},Ye={key:0,class:"bs-dialog-footer"},Ne=ve({__name:"addDialog",props:{isShow:{type:Boolean,default:!1},dialogType:{type:String,default:"add"},dialogData:{type:Object,default:()=>({})},title:{type:String,default:""},jumpPage:{type:String,default:""}},emits:["update:isShow","closed","success"],setup(U,{emit:L}){const S=L,m=U,D=R(),J=R(),d=x({dialogTitle:"提示",isShowDialog:!1,tableLoading:!1,dialogSubmitBtnLoading:!1,dialogIsLook:!1,selectedRows:[],columnWidth:280}),{dialogTitle:M,isShowDialog:y,tableLoading:I,dialogSubmitBtnLoading:F,dialogIsLook:H,selectedRows:q,columnWidth:h}=B(d),V=x({deptOptions:[],levelOptions:[]}),{deptOptions:A,levelOptions:Ue}=B(V),p=x({tableData:[]}),c=x({name:[{required:!0,message:"请输入名称",trigger:"blur"}],dept:[{required:!0,message:"请选择部门",trigger:"change"}],operator:[{required:!0,message:"请输入操作人名称",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}],createDate:[{validator:(e,t,r)=>{if(!t)r(new Error("请选择创建时间"));else{var o=e.field.substr(10,1),g=p.tableData[o].updateDate,u=E.Jh_compareTimes(t,g);u&&r(new Error("创建时间不能大于操作时间!")),r()}},trigger:"change"}],updateDate:[{validator:(e,t,r)=>{if(!t)r(new Error("请选择操作时间"));else{var o=e.field.substr(10,1),g=E.Jh_compareTimes(t,p.tableData[o].createDate);g||r(new Error("操作时间不能小于创建时间!")),r()}},trigger:"change"}]});_(()=>m.isShow,e=>{d.isShowDialog=e}),_(()=>d.isShowDialog,e=>{S("update:isShow",e)}),_(()=>m.title,e=>{d.dialogTitle=e.length?e:d.dialogTitle}),_(()=>m.dialogData,e=>{p.tableData=JSON.parse(JSON.stringify(e.tableData))}),_(()=>m.dialogType,e=>{d.dialogTitle=m.title||(e==="add"?"新增":e==="edit"?"编辑":e==="look"?"查看":d.dialogTitle),d.dialogIsLook=e==="look"},{immediate:!0}),Se(()=>{O()});const O=()=>{De().then(e=>{e.code===2e4?V.deptOptions=e.data:f.warning(e.msg)})},z=()=>{m.dialogType==="add"&&D.value.clearValidate(),V.deptOptions.length||O()},P=()=>{d.dialogIsLook||D.value.resetFields(),S("closed",{})},W=e=>{d.selectedRows=e},j=({row:e,column:t,rowIndex:r,columnIndex:o})=>r===0&&o===0?{textAlign:"center",background:"#eef1f6",display:"none"}:{textAlign:"center",background:"#f5f5f5"},G=({row:e,column:t,rowIndex:r,columnIndex:o})=>({textAlign:"center"}),K=({row:e,rowIndex:t})=>{e.xh=t+1},b=({column:e,$index:t})=>[N("span",{style:"color: red"},"*"),N("span"," "+e.label)],Q=()=>{var e={xh:33,id:"",name:"",dept:"",operator:"",content:"",createDate:"",updateDate:""};p.tableData.push(e)},X=()=>{if(d.selectedRows.length===0){f.warning("请选择记录");return}$.confirm("此操作将永久删除, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var e=[];for(let t=0;t<d.selectedRows.length;t++)e.push(d.selectedRows[t].xh);e.sort(function(t,r){return t-r}),console.log("新数组排序后："+e);for(let t=0;t<e.length;t++)p.tableData.splice(e[t]-t-1,1);f.success("删除成功!")}).catch(()=>{})},Z=e=>{console.log(JSON.stringify(e))},ee=e=>{console.log(JSON.stringify(e)),$.confirm(`确定要删除用户 ${e.name} ，此操作将永久删除, 是否继续?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{p.tableData.splice(Number(e.xh)-1,1),f.success("删除成功!")}).catch(()=>{})},te=()=>{D.value.validate((e,t)=>{e?(console.log("submit!"),ae()):(console.log("error submit!",t),f.warning("有未输入项!"))})},ae=()=>{console.log("验证通过 开始提交数据 。。。submitRequest"),console.log("tableform",JSON.stringify(p));const e=JSON.parse(JSON.stringify(p));console.log(JSON.stringify(e)),d.dialogSubmitBtnLoading=!0;const t=m.dialogType==="add"?"新增成功!":"编辑成功!";(m.dialogType==="add"?ye(e):xe(e)).then(o=>{d.dialogSubmitBtnLoading=!1,o.code===2e4?(f.success(t),d.isShowDialog=!1,S("success",{})):f.warning(o.msg)}).catch(o=>{d.dialogSubmitBtnLoading=!1,console.log(JSON.stringify(o))})};return(e,t)=>{const r=se,o=pe,g=me,u=ue,le=ce,oe=ge,C=fe,ne=he,ie=be,re=_e,de=we;return w(),k("div",null,[l(re,{title:i(M),modelValue:i(y),"onUpdate:modelValue":t[2]||(t[2]=a=>Ce(y)?y.value=a:null),top:"8vh",width:"90%","close-on-click-modal":!1,onOpened:z,onClosed:P},{default:n(()=>[T("div",Ee,[T("div",Re,[T("div",Be,[l(r,{type:"primary",icon:"i-ep-plus",onClick:Q},{default:n(()=>[v(" 新增 ")]),_:1}),l(r,{type:"danger",icon:"i-ep-delete",disabled:i(q).length==0,onClick:X},{default:n(()=>[v(" 删除 ")]),_:1},8,["disabled"])]),l(ie,{ref_key:"dialogFormRef",ref:D,model:i(p),"label-width":"120px",inline:!0,rules:i(c),size:"small","label-position":"left"},{default:n(()=>[Ve((w(),Y(ne,{ref_key:"tableRef",ref:J,class:"my-table",data:i(p).tableData,stripe:!0,"header-cell-style":j,"cell-style":G,"row-class-name":K,border:"",onSelectionChange:W,style:{width:"100%"}},{default:n(()=>[l(o,{label:""},{default:n(()=>[l(o,{type:"index",label:"序号",prop:"xh",width:"80px"}),l(o,{type:"selection",width:"55px",label:""}),l(o,{label:"名称","render-header":b,"min-width":i(h)},{default:n(a=>[l(u,{prop:`tableData.${a.$index}.name`,rules:i(c).name,style:{width:"200px"}},{default:n(()=>[l(g,{modelValue:a.row.name,"onUpdate:modelValue":s=>a.row.name=s,maxlength:"20",placeholder:"请输入",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1},8,["min-width"]),l(o,{label:"部门","render-header":b,"min-width":i(h)},{default:n(a=>[l(u,{prop:`tableData.${a.$index}.dept`,rules:i(c).dept},{default:n(()=>[l(oe,{modelValue:a.row.dept,"onUpdate:modelValue":s=>a.row.dept=s,placeholder:"请选择","collapse-tags":"",clearable:"",style:{width:"200px"}},{default:n(()=>[(w(!0),k(ke,null,Te(i(A),s=>(w(),Y(le,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1},8,["min-width"]),l(o,{label:"操作人","render-header":b,"min-width":i(h)},{default:n(a=>[l(u,{prop:`tableData.${a.$index}.operator`,rules:i(c).operator,style:{width:"200px"}},{default:n(()=>[l(g,{modelValue:a.row.operator,"onUpdate:modelValue":s=>a.row.operator=s,maxlength:"10",placeholder:"请输入",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1},8,["min-width"]),l(o,{label:"内容","render-header":b,"min-width":i(h)},{default:n(a=>[l(u,{prop:`tableData.${a.$index}.content`,rules:i(c).content},{default:n(()=>[l(g,{modelValue:a.row.content,"onUpdate:modelValue":s=>a.row.content=s,maxlength:"100",placeholder:"请输入",type:"textarea",autosize:{minRows:2,maxRows:2},clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1},8,["min-width"]),l(o,{label:"创建时间","render-header":b,width:i(h)},{default:n(a=>[l(u,{prop:`tableData.${a.$index}.createDate`,rules:i(c).createDate},{default:n(()=>[l(C,{modelValue:a.row.createDate,"onUpdate:modelValue":s=>a.row.createDate=s,type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm",placeholder:"选择日期"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1},8,["width"]),l(o,{label:"操作时间","render-header":b,width:i(h)},{default:n(a=>[l(u,{prop:`tableData.${a.$index}.updateDate`,rules:i(c).updateDate},{default:n(()=>[l(C,{modelValue:a.row.updateDate,"onUpdate:modelValue":s=>a.row.updateDate=s,type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm",placeholder:"选择日期"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1},8,["width"]),l(o,{fixed:"right",label:"操作",width:"120px"},{default:n(a=>[l(r,{size:"small",icon:"i-ep-edit",onClick:s=>Z(a.row)},null,8,["onClick"]),l(r,{size:"small",icon:"i-ep-delete",type:"danger",onClick:s=>ee(a.row)},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["data"])),[[de,i(I)]])]),_:1},8,["model","rules"])]),i(H)?Oe("",!0):(w(),k("div",Ye,[l(r,{onClick:t[0]||(t[0]=a=>y.value=!1)},{default:n(()=>[v(" 取消 ")]),_:1}),l(r,{loading:i(F),type:"primary",onClick:t[1]||(t[1]=a=>te())},{default:n(()=>[v(" 保存 ")]),_:1},8,["loading"])]))])]),_:1},8,["title","modelValue"])])}}}),gt=$e(Ne,[["__scopeId","data-v-42bfdee5"]]);export{gt as default};
