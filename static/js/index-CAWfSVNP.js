import{b as v,a as $,k as he,w as ye,F as ve,G as De,H as Se,c as ke,v as Re,I as xe,j as Ce,J as Ne,K as Oe}from"./element-plus-Bdn4kiSG.js";import{_ as Ee}from"./index-ZZnGISxz.js";import{d as Te,r as Je,_ as I,$ as A,f as Ve,an as Ue,o as b,c as z,a as i,W as l,P as n,u as o,af as K,F as Ie,ab as Ae,O as w,l as P,U as h,Q as m,V as S,a1 as Pe,R as Le,X as Be,bm as Fe,bk as qe}from"./@vue-DBL8Ibom.js";import{c as Ye}from"./base-io3ORlSv.js";import{g as j,d as Me,r as $e}from"./user-poya1pXY.js";import ze from"./addDialog-BbpemSqY.js";import Ke from"./assignRoleDialog-JqNZ-duy.js";import{T as N}from"./timeUtils-CwNtu00v.js";import{e as je}from"./exportExcel-Du1570hA.js";import{_ as Ge}from"./index-DFeBoV3U.js";import"./lodash-es-Blijzk1b.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-BThtamsc.js";import"./dayjs-C6J0yRL_.js";import"./@intlify-CHY6szXs.js";import"./@sxzz-D9SI2xQl.js";import"./@element-plus-BmjHI8io.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./dict-BYyJu2Xi.js";import"./checkUtils-DBVKUKAZ.js";import"./role-BabOENuR.js";import"./xlsx-DjuO7_Ju.js";import"./pinia-7g9vQp6f.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-fhvlCfPF.js";import"./crypto-js-CYDAzdEe.js";import"./axios-CCb-kr4I.js";import"./js-cookie-Cz0CWeBA.js";import"./vue-i18n-B8qYdFXi.js";import"./vue-rTnkxsfK.js";import"./vue-draggable-plus-BSvTyIk2.js";import"./nprogress-yi2QV7xY.js";import"./mockjs-DsSR4jwH.js";import"./vite-plugin-mock-CDJiH8Qs.js";import"./path-to-regexp-BzK_ZY7n.js";const O=k=>(Fe("data-v-b04062c2"),k=k(),qe(),k),He={class:"bs-page-body"},Qe=O(()=>i("span",{class:"bs-form-label",style:{width:"80px"}},[i("span",{class:"icon"},"姓名:")],-1)),We=O(()=>i("span",{class:"bs-form-label"},[i("span",{class:"icon"},"员工编号:")],-1)),Xe=O(()=>i("span",{class:"bs-form-label",style:{width:"80px"}},[i("span",{class:"icon"},"部门:")],-1)),Ze=O(()=>i("span",{class:"bs-form-label",style:{width:"100px"}},[i("span",{class:"icon"},"创建时间:")],-1)),et={class:"bs-page-table"},tt={class:"bs-table-btns"},at=["onClick"],lt={style:{color:"#00a0e9","text-decoration":"underline"}},ot={class:"bs-tooltip-text"},st=Te({__name:"index",setup(k){const L=Je(),s=I({tableTotal:0,tableLoading:!1,tableData:[],queryParams:{page:1,limit:10,startDate:"",endDate:"",name:"",userNumber:"",deptId:""},dateRange:[],selectedRows:[]}),{tableTotal:B,tableLoading:G,tableData:H,queryParams:c,dateRange:E,selectedRows:R}=A(s),D=I({deptOptions:[],levelOptions:[]}),{deptOptions:F,levelOptions:Q}=A(D),d=I({isShowDialog:!1,dialogType:"add",dialogFormData:{},isShowDialogAssignRole:!1,assignRoleUserData:{}}),{isShowDialog:T,dialogType:W,dialogFormData:X,isShowDialogAssignRole:J,assignRoleUserData:Z}=A(d);Ve(()=>{ee(),y()});const ee=()=>{Ye().then(e=>{e.code===2e4?(D.deptOptions=e.data.dept,D.levelOptions=e.data.level):v.warning(e.msg)})},y=()=>{var e=JSON.parse(JSON.stringify(s.queryParams));e.startDate=s.dateRange?N.startOfDay(s.dateRange[0]):"",e.endDate=s.dateRange?N.endOfDay(s.dateRange[1]):"",console.log(JSON.stringify(e)),s.tableLoading=!0,j(e).then(t=>{s.tableLoading=!1,t.code===2e4?(s.tableData=t.data,s.tableTotal=t.total):v.warning(t.msg)}).catch(t=>{s.tableLoading=!1,console.log(JSON.stringify(t))})},V=()=>{s.queryParams.page=1,y()},x=e=>!e.loginName.toLowerCase().includes("admin"),te=e=>{s.selectedRows=e},C=(e,t)=>{const r=t.findIndex(u=>u.value===e);if(r!==-1)return t[r].label},ae=e=>e.status==="0"?"#E6A23C":"#67C23A",le=()=>{d.dialogType="add",d.dialogFormData={},d.isShowDialog=!0},q=e=>{const t=JSON.parse(JSON.stringify(e&&e.id?e:s.selectedRows[0]));d.dialogType="edit",d.dialogFormData=t,d.isShowDialog=!0},oe=e=>{const t=JSON.parse(JSON.stringify(e&&e.id?e:s.selectedRows[0]));d.dialogType="look",d.dialogFormData=t,d.isShowDialog=!0},Y=e=>{var t="";e&&e.id?t=e.name:t=s.selectedRows.map(r=>r.name).join(","),$.confirm(`确定要删除用户 ${t} ，此操作将永久删除, 是否继续?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var r={ids:[]};if(e&&e.id)r.ids=[e.id];else{const u=s.selectedRows.map(g=>g.id);r.ids=u}se(r)})},se=e=>{Me(e).then(t=>{t.code===2e4?(v.success("删除成功!"),y()):v.warning(t.msg)})},ne=()=>{if(s.selectedRows.length===0){var e=JSON.parse(JSON.stringify(s.queryParams));e.startDate=s.dateRange?N.startOfDay(s.dateRange[0]):"",e.endDate=s.dateRange?N.endOfDay(s.dateRange[1]):"",e.page=0,e.limit=1e3,console.log(JSON.stringify(e)),j(e).then(t=>{const{data:r}=t;M(r)})}else M(s.selectedRows)},M=e=>{var t=e;t.forEach(g=>{g.deptName=C(g.deptId,D.deptOptions),g.statusText=g.status==="0"?"停用":"启用",g.levelName=C(g.level,D.levelOptions)}),je(t,["name","loginName","userNumber","deptName","statusText","userExpiryDate","levelName","notes","phone"],["姓名","用户名","员工编号","部门","状态","用户有效期至","级别","备注","手机号"],"用户数据.xlsx")},ie=()=>{d.assignRoleUserData=JSON.parse(JSON.stringify(s.selectedRows[0])),d.isShowDialogAssignRole=!0},de=e=>{d.dialogType="look",d.dialogFormData=JSON.parse(JSON.stringify(e)),d.isShowDialog=!0},re=e=>{$.confirm(`确定要重置 ${e.name} 的密码, 是否继续 ?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const t={id:e.id};pe(t)})},pe=e=>{console.log(JSON.stringify(e)),$e(e).then(t=>{t.code===2e4?(v.success("重置密码成功!"),y()):v.warning(t.msg)})},ce=()=>{L.value.clearSelection()};return(e,t)=>{const r=he,u=ye,g=ve,me=De,ue=Se,f=ke,ge=Re,p=xe,fe=Ce,be=Ne,_e=Ee,_=Ue("hasPerm"),we=Oe;return b(),z("div",null,[i("div",He,[l(ge,{inline:!0,model:o(c),class:"bs-form-search mt10"},{default:n(()=>[l(u,null,{default:n(()=>[Qe,l(r,{modelValue:o(c).name,"onUpdate:modelValue":t[0]||(t[0]=a=>o(c).name=a),maxlength:"20",placeholder:"请输入姓名",clearable:"",onKeyup:K(V,["enter","native"])},null,8,["modelValue"])]),_:1}),l(u,null,{default:n(()=>[We,l(r,{modelValue:o(c).userNumber,"onUpdate:modelValue":t[1]||(t[1]=a=>o(c).userNumber=a),maxlength:"20",placeholder:"请输入员工编号",clearable:"",onKeyup:K(V,["enter","native"])},null,8,["modelValue"])]),_:1}),l(u,null,{default:n(()=>[Xe,l(me,{modelValue:o(c).deptId,"onUpdate:modelValue":t[2]||(t[2]=a=>o(c).deptId=a),placeholder:"请选择",filterable:"",clearable:""},{default:n(()=>[(b(!0),z(Ie,null,Ae(o(F),a=>(b(),w(g,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,null,{default:n(()=>[Ze,l(ue,{modelValue:o(E),"onUpdate:modelValue":t[3]||(t[3]=a=>P(E)?E.value=a:null),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",format:"YYYY年MM月DD日"},null,8,["modelValue"])]),_:1}),l(u,null,{default:n(()=>[l(f,{class:"bs-form-btn",type:"primary",onClick:V},{default:n(()=>[h("查询")]),_:1})]),_:1})]),_:1},8,["model"]),i("div",et,[i("div",tt,[m((b(),w(f,{type:"primary",icon:"i-ep-plus",onClick:le},{default:n(()=>[h(" 新增 ")]),_:1})),[[_,["user-add"]]]),m((b(),w(f,{type:"primary",icon:"i-ep-edit",disabled:o(R).length!==1,onClick:q},{default:n(()=>[h(" 编辑 ")]),_:1},8,["disabled"])),[[_,["user-edit"]]]),m((b(),w(f,{type:"primary",icon:"i-ep-search",disabled:o(R).length!==1,onClick:oe},{default:n(()=>[h(" 查看 ")]),_:1},8,["disabled"])),[[_,["user-look"]]]),m((b(),w(f,{type:"warning",icon:"i-ep-download",onClick:ne},{default:n(()=>[h(" 导出 ")]),_:1})),[[_,["user-export"]]]),m((b(),w(f,{type:"danger",icon:"i-ep-delete",disabled:o(R).length==0,onClick:Y},{default:n(()=>[h(" 删除 ")]),_:1},8,["disabled"])),[[_,["user-delete"]]]),m((b(),w(f,{type:"warning",icon:"i-ep-setting",disabled:o(R).length!==1,onClick:ie},{default:n(()=>[h(" 角色分配 ")]),_:1},8,["disabled"])),[[_,["user-assign"]]])]),m((b(),w(be,{ref_key:"tableRef",ref:L,class:"bs-table",data:o(H),stripe:!0,"header-cell-style":{textAlign:"center"},"cell-style":{textAlign:"center"},onSelectionChange:te},{default:n(()=>[l(p,{prop:"number",type:"index",label:"序号","min-width":"60"}),l(p,{type:"selection",width:"55",selectable:x}),l(p,{label:"姓名","min-width":"100"},{default:n(a=>[i("span",{onClick:U=>de(a.row)},[i("a",lt,S(a.row.name),1)],8,at)]),_:1}),l(p,{prop:"loginName",label:"用户名","min-width":"120"}),l(p,{prop:"userNumber",label:"员工编号","min-width":"120",sortable:""}),l(p,{label:"部门","min-width":"130"},{default:n(a=>[i("div",null,S(C(a.row.deptId,o(F))),1)]),_:1}),l(p,{label:"状态"},{default:n(a=>[i("div",{style:Pe({background:ae(a.row)}),class:"tagClass"},S(a.row.status==="0"?"停用":"启用"),5)]),_:1}),l(p,{prop:"userExpiryDate",label:"用户有效期至",sortable:"","min-width":"140"}),l(p,{label:"级别","min-width":"100"},{default:n(a=>[i("div",{class:Le(a.row.level=="1"?"b-tag-success":a.row.level=="2"?"b-tag-warning":"b-tag-error")},S(C(a.row.level,o(Q))),3)]),_:1}),l(p,{prop:"phone",label:"手机号","min-width":"120"}),l(p,{label:"备注","min-width":"100"},{default:n(a=>[l(fe,{"visible-arrow":!1,effect:"light",content:a.row.notes,placement:"bottom"},{default:n(()=>[i("span",ot,S(a.row.notes),1)]),_:2},1032,["content"])]),_:1}),l(p,{fixed:"right",label:"操作",width:"180"},{default:n(a=>[m(l(f,{size:"small",icon:"i-ep-edit",disabled:!x(a.row),onClick:U=>q(a.row)},null,8,["disabled","onClick"]),[[_,["user-edit"]]]),m(l(f,{size:"small",icon:"i-ep-delete",type:"danger",disabled:!x(a.row),onClick:U=>Y(a.row)},null,8,["disabled","onClick"]),[[_,["user-delete"]]]),m(l(f,{size:"small",icon:"i-ep-refresh-left",type:"danger",disabled:!x(a.row),onClick:U=>re(a.row)},null,8,["disabled","onClick"]),[[_,["user-resetPwd"]]])]),_:1})]),_:1},8,["data"])),[[we,o(G)]]),m(l(_e,{total:o(B),page:o(c).page,"onUpdate:page":t[4]||(t[4]=a=>o(c).page=a),limit:o(c).limit,"onUpdate:limit":t[5]||(t[5]=a=>o(c).limit=a),onPagination:y},null,8,["total","page","limit"]),[[Be,o(B)>0]])]),l(ze,{"dialog-type":o(W),"is-show":o(T),"onUpdate:isShow":t[6]||(t[6]=a=>P(T)?T.value=a:null),"dialog-data":o(X),onSuccess:y,onClosed:ce},null,8,["dialog-type","is-show","dialog-data"]),l(Ke,{"is-show":o(J),"onUpdate:isShow":t[7]||(t[7]=a=>P(J)?J.value=a:null),"dialog-data":o(Z)},null,8,["is-show","dialog-data"])])])}}}),Yt=Ge(st,[["__scopeId","data-v-b04062c2"]]);export{Yt as default};
