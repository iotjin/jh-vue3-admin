import{a as C}from"./prosemirror-state-B_E398uK.js";class a{constructor(l,e,t={}){this.match=l,this.match=l,this.handler=typeof e=="string"?M(e):e,this.undoable=t.undoable!==!1,this.inCode=t.inCode||!1,this.inCodeMark=t.inCodeMark!==!1}}function M(s){return function(l,e,t,r){let n=s;if(e[1]){let i=e[0].lastIndexOf(e[1]);n+=e[0].slice(i+e[1].length),t+=i;let o=t-r;o>0&&(n=e[0].slice(i-o,i)+n,t=r)}return l.tr.insertText(n,t,r)}}const m=500;function x({rules:s}){let l=new C({state:{init(){return null},apply(e,t){let r=e.getMeta(this);return r||(e.selectionSet||e.docChanged?null:t)}},props:{handleTextInput(e,t,r,n){return g(e,t,r,n,s,l)},handleDOMEvents:{compositionend:e=>{setTimeout(()=>{let{$cursor:t}=e.state.selection;t&&g(e,t.pos,t.pos,"",s,l)})}}},isInputRules:!0});return l}function g(s,l,e,t,r,n){if(s.composing)return!1;let i=s.state,o=i.doc.resolve(l),u=o.parent.textBetween(Math.max(0,o.parentOffset-m),o.parentOffset,null,"￼")+t;for(let d=0;d<r.length;d++){let f=r[d];if(!f.inCodeMark&&o.marks().some(h=>h.type.spec.code))continue;if(o.parent.type.spec.code){if(!f.inCode)continue}else if(f.inCode==="only")continue;let c=f.match.exec(u),p=c&&c[0].length>=t.length&&f.handler(i,c,l-(c[0].length-t.length),e);if(p)return f.undoable&&p.setMeta(n,{transform:p,from:l,to:e,text:t}),s.dispatch(p),!0}return!1}const $=(s,l)=>{let e=s.plugins;for(let t=0;t<e.length;t++){let r=e[t],n;if(r.spec.isInputRules&&(n=r.getState(s))){if(l){let i=s.tr,o=n.transform;for(let u=o.steps.length-1;u>=0;u--)i.step(o.steps[u].invert(o.docs[u]));if(n.text){let u=i.doc.resolve(n.from).marks();i.replaceWith(n.from,n.to,s.schema.text(n.text,u))}else i.delete(n.from,n.to);l(i)}return!0}}return!1};new a(/--$/,"—",{inCodeMark:!1});new a(/\.\.\.$/,"…",{inCodeMark:!1});new a(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"“",{inCodeMark:!1});new a(/"$/,"”",{inCodeMark:!1});new a(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"‘",{inCodeMark:!1});new a(/'$/,"’",{inCodeMark:!1});export{a as I,x as i,$ as u};
