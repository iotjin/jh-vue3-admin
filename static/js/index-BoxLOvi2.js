import{b as R,a as j,k as ye,w as ve,F as De,G as Se,H as ke,c as xe,v as Re,P as Ce,j as Ne,Q as Oe,R as Ee}from"./element-plus-C1_tH_9n.js";import{_ as Te}from"./index-XscN0ITR.js";import{d as Ae,r as Je,_ as L,$ as B,f as Ve,am as Ue,o as b,c as Q,a as i,W as l,P as n,u as s,ae as G,F as Pe,aa as Ie,O as w,l as q,U as v,Q as m,V as N,a1 as Fe,R as Le,X as Be,bm as qe,bk as Ye}from"./@vue-ROmf2CMa.js";import{g as Me,A as $e}from"./addDialog-Cv6PQS6T.js";import{g as H,d as ze,r as Ke}from"./user-D-Uuth3N.js";import je from"./assignRoleDialog-DhNcXv_e.js";import{T as A}from"./timeUtils-CwNtu00v.js";import{u as Y,w as Qe}from"./xlsx-DjuO7_Ju.js";import{_ as Ge}from"./index-B8W-cxH9.js";import"./lodash-es-Blijzk1b.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-Cv4Wji3s.js";import"./dayjs-C6J0yRL_.js";import"./@intlify-CHY6szXs.js";import"./@element-plus-Ds9axIkZ.js";import"./@ctrl-r5W6hzzQ.js";import"./@sxzz-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./dict-AH912pMj.js";import"./checkUtils-DBVKUKAZ.js";import"./role-CZTTXqXZ.js";import"./pinia-CNAM5qpy.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-CP6FQFzT.js";import"./crypto-js-CYDAzdEe.js";import"./axios-mH-cpkvd.js";import"./js-cookie-Cz0CWeBA.js";import"./vue-i18n-BHOT87Ho.js";import"./vue-DoOO_nKc.js";import"./nprogress-E-flP1tB.js";import"./mockjs-DOFpbtyb.js";import"./vite-plugin-mock-B2SH9_m9.js";import"./path-to-regexp-Cdn6gXUT.js";function He(h,C,o=[],O="Excel.xlsx",V="Sheet"){let D=new Array;if(!Array.isArray(h))return console.warn("dataList is not an array type");D=h.map(k=>C.map(y=>k[y])),o.length>0?D.splice(0,0,o):D.splice(0,0,C);const c=Y.aoa_to_sheet(D),S=Y.book_new();Y.book_append_sheet(S,c,V),Qe(S,O)}const J=h=>(qe("data-v-b04062c2"),h=h(),Ye(),h),We={class:"bs-page-body"},Xe=J(()=>i("span",{class:"bs-form-label",style:{width:"80px"}},[i("span",{class:"icon"},"姓名:")],-1)),Ze=J(()=>i("span",{class:"bs-form-label"},[i("span",{class:"icon"},"员工编号:")],-1)),et=J(()=>i("span",{class:"bs-form-label",style:{width:"80px"}},[i("span",{class:"icon"},"部门:")],-1)),tt=J(()=>i("span",{class:"bs-form-label",style:{width:"100px"}},[i("span",{class:"icon"},"创建时间:")],-1)),at={class:"bs-page-table"},lt={class:"bs-table-btns"},ot=["onClick"],st={style:{color:"#00a0e9","text-decoration":"underline"}},nt={class:"bs-tooltip-text"},it=Ae({__name:"index",setup(h){const C=Je(),o=L({tableTotal:0,tableLoading:!1,tableData:[],queryParams:{page:1,limit:10,startDate:"",endDate:"",name:"",userNumber:"",deptId:""},dateRange:[],selectedRows:[]}),{tableTotal:O,tableLoading:V,tableData:D,queryParams:c,dateRange:S,selectedRows:k}=B(o),y=L({deptOptions:[],levelOptions:[]}),{deptOptions:M,levelOptions:W}=B(y),d=L({isShowDialog:!1,dialogType:"add",dialogFormData:{},isShowDialogAssignRole:!1,assignRoleUserData:{}}),{isShowDialog:U,dialogType:X,dialogFormData:Z,isShowDialogAssignRole:P,assignRoleUserData:ee}=B(d);Ve(()=>{te(),x()});const te=()=>{Me().then(e=>{e.code===2e4?(y.deptOptions=e.data.dept,y.levelOptions=e.data.level):R.warning(e.msg)})},x=()=>{var e=JSON.parse(JSON.stringify(o.queryParams));e.startDate=o.dateRange?A.startOfDay(o.dateRange[0]):"",e.endDate=o.dateRange?A.endOfDay(o.dateRange[1]):"",console.log(JSON.stringify(e)),o.tableLoading=!0,H(e).then(t=>{o.tableLoading=!1,t.code===2e4?(o.tableData=t.data,o.tableTotal=t.total):R.warning(t.msg)}).catch(t=>{o.tableLoading=!1,console.log(JSON.stringify(t))})},I=()=>{o.queryParams.page=1,x()},E=e=>!e.loginName.toLowerCase().includes("admin"),ae=e=>{o.selectedRows=e},T=(e,t)=>{const r=t.findIndex(u=>u.value===e);if(r!==-1)return t[r].label},le=e=>e.status==="0"?"#E6A23C":"#67C23A",oe=()=>{d.dialogType="add",d.dialogFormData={},d.isShowDialog=!0},$=e=>{const t=JSON.parse(JSON.stringify(e&&e.id?e:o.selectedRows[0]));d.dialogType="edit",d.dialogFormData=t,d.isShowDialog=!0},se=e=>{const t=JSON.parse(JSON.stringify(e&&e.id?e:o.selectedRows[0]));d.dialogType="look",d.dialogFormData=t,d.isShowDialog=!0},z=e=>{var t="";e&&e.id?t=e.name:t=o.selectedRows.map(r=>r.name).join(","),j.confirm(`确定要删除用户 ${t} ，此操作将永久删除, 是否继续?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var r={ids:[]};if(e&&e.id)r.ids=[e.id];else{const u=o.selectedRows.map(g=>g.id);r.ids=u}ne(r)})},ne=e=>{ze(e).then(t=>{t.code===2e4?(R.success("删除成功!"),x()):R.warning(t.msg)})},ie=()=>{if(o.selectedRows.length===0){var e=JSON.parse(JSON.stringify(o.queryParams));e.startDate=o.dateRange?A.startOfDay(o.dateRange[0]):"",e.endDate=o.dateRange?A.endOfDay(o.dateRange[1]):"",e.page=0,e.limit=1e3,console.log(JSON.stringify(e)),H(e).then(t=>{const{data:r}=t;K(r)})}else K(o.selectedRows)},K=e=>{var t=e;t.forEach(g=>{g.deptName=T(g.deptId,y.deptOptions),g.statusText=g.status==="0"?"停用":"启用",g.levelName=T(g.level,y.levelOptions)}),He(t,["name","loginName","userNumber","deptName","statusText","userExpiryDate","levelName","notes","phone"],["姓名","用户名","员工编号","部门","状态","用户有效期至","级别","备注","手机号"],"用户数据.xlsx")},de=()=>{d.assignRoleUserData=JSON.parse(JSON.stringify(o.selectedRows[0])),d.isShowDialogAssignRole=!0},re=e=>{d.dialogType="look",d.dialogFormData=JSON.parse(JSON.stringify(e)),d.isShowDialog=!0},ce=e=>{j.confirm(`确定要重置 ${e.name} 的密码, 是否继续 ?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const t={id:e.id};pe(t)})},pe=e=>{console.log(JSON.stringify(e)),Ke(e).then(t=>{t.code===2e4?(R.success("重置密码成功!"),x()):R.warning(t.msg)})},me=()=>{C.value.clearSelection()};return(e,t)=>{const r=ye,u=ve,g=De,ue=Se,ge=ke,f=xe,fe=Re,p=Ce,be=Ne,_e=Oe,we=Te,_=Ue("hasPerm"),he=Ee;return b(),Q("div",null,[i("div",We,[l(fe,{inline:!0,model:s(c),class:"bs-form-search mt10"},{default:n(()=>[l(u,null,{default:n(()=>[Xe,l(r,{modelValue:s(c).name,"onUpdate:modelValue":t[0]||(t[0]=a=>s(c).name=a),maxlength:"20",placeholder:"请输入姓名",clearable:"",onKeyup:G(I,["enter","native"])},null,8,["modelValue"])]),_:1}),l(u,null,{default:n(()=>[Ze,l(r,{modelValue:s(c).userNumber,"onUpdate:modelValue":t[1]||(t[1]=a=>s(c).userNumber=a),maxlength:"20",placeholder:"请输入员工编号",clearable:"",onKeyup:G(I,["enter","native"])},null,8,["modelValue"])]),_:1}),l(u,null,{default:n(()=>[et,l(ue,{modelValue:s(c).deptId,"onUpdate:modelValue":t[2]||(t[2]=a=>s(c).deptId=a),placeholder:"请选择",filterable:"",clearable:""},{default:n(()=>[(b(!0),Q(Pe,null,Ie(s(M),a=>(b(),w(g,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,null,{default:n(()=>[tt,l(ge,{modelValue:s(S),"onUpdate:modelValue":t[3]||(t[3]=a=>q(S)?S.value=a:null),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",format:"YYYY年MM月DD日"},null,8,["modelValue"])]),_:1}),l(u,null,{default:n(()=>[l(f,{class:"bs-form-btn",type:"primary",onClick:I},{default:n(()=>[v("查询")]),_:1})]),_:1})]),_:1},8,["model"]),i("div",at,[i("div",lt,[m((b(),w(f,{type:"primary",icon:"i-ep-plus",onClick:oe},{default:n(()=>[v(" 新增 ")]),_:1})),[[_,["user-add"]]]),m((b(),w(f,{type:"primary",icon:"i-ep-edit",disabled:s(k).length!==1,onClick:$},{default:n(()=>[v(" 编辑 ")]),_:1},8,["disabled"])),[[_,["user-edit"]]]),m((b(),w(f,{type:"primary",icon:"i-ep-search",disabled:s(k).length!==1,onClick:se},{default:n(()=>[v(" 查看 ")]),_:1},8,["disabled"])),[[_,["user-look"]]]),m((b(),w(f,{type:"warning",icon:"i-ep-download",onClick:ie},{default:n(()=>[v(" 导出 ")]),_:1})),[[_,["user-export"]]]),m((b(),w(f,{type:"danger",icon:"i-ep-delete",disabled:s(k).length==0,onClick:z},{default:n(()=>[v(" 删除 ")]),_:1},8,["disabled"])),[[_,["user-delete"]]]),m((b(),w(f,{type:"warning",icon:"i-ep-setting",disabled:s(k).length!==1,onClick:de},{default:n(()=>[v(" 角色分配 ")]),_:1},8,["disabled"])),[[_,["user-assign"]]])]),m((b(),w(_e,{ref_key:"tableRef",ref:C,class:"bs-table",data:s(D),stripe:!0,"header-cell-style":{textAlign:"center"},"cell-style":{textAlign:"center"},onSelectionChange:ae},{default:n(()=>[l(p,{prop:"number",type:"index",label:"序号","min-width":"60"}),l(p,{type:"selection",width:"55",selectable:E}),l(p,{label:"姓名","min-width":"100"},{default:n(a=>[i("span",{onClick:F=>re(a.row)},[i("a",st,N(a.row.name),1)],8,ot)]),_:1}),l(p,{prop:"loginName",label:"用户名","min-width":"120"}),l(p,{prop:"userNumber",label:"员工编号","min-width":"120",sortable:""}),l(p,{label:"部门","min-width":"130"},{default:n(a=>[i("div",null,N(T(a.row.deptId,s(M))),1)]),_:1}),l(p,{label:"状态"},{default:n(a=>[i("div",{style:Fe({background:le(a.row)}),class:"tagClass"},N(a.row.status==="0"?"停用":"启用"),5)]),_:1}),l(p,{prop:"userExpiryDate",label:"用户有效期至",sortable:"","min-width":"140"}),l(p,{label:"级别","min-width":"100"},{default:n(a=>[i("div",{class:Le(a.row.level=="1"?"b-tag-success":a.row.level=="2"?"b-tag-warning":"b-tag-error")},N(T(a.row.level,s(W))),3)]),_:1}),l(p,{prop:"phone",label:"手机号","min-width":"120"}),l(p,{label:"备注","min-width":"100"},{default:n(a=>[l(be,{"visible-arrow":!1,effect:"light",content:a.row.notes,placement:"bottom"},{default:n(()=>[i("span",nt,N(a.row.notes),1)]),_:2},1032,["content"])]),_:1}),l(p,{fixed:"right",label:"操作",width:"180"},{default:n(a=>[m(l(f,{size:"small",icon:"i-ep-edit",disabled:!E(a.row),onClick:F=>$(a.row)},null,8,["disabled","onClick"]),[[_,["user-edit"]]]),m(l(f,{size:"small",icon:"i-ep-delete",type:"danger",disabled:!E(a.row),onClick:F=>z(a.row)},null,8,["disabled","onClick"]),[[_,["user-delete"]]]),m(l(f,{size:"small",icon:"i-ep-refresh-left",type:"danger",disabled:!E(a.row),onClick:F=>ce(a.row)},null,8,["disabled","onClick"]),[[_,["user-resetPwd"]]])]),_:1})]),_:1},8,["data"])),[[he,s(V)]]),m(l(we,{total:s(O),page:s(c).page,"onUpdate:page":t[4]||(t[4]=a=>s(c).page=a),limit:s(c).limit,"onUpdate:limit":t[5]||(t[5]=a=>s(c).limit=a),onPagination:x},null,8,["total","page","limit"]),[[Be,s(O)>0]])]),l($e,{"dialog-type":s(X),"is-show":s(U),"onUpdate:isShow":t[6]||(t[6]=a=>q(U)?U.value=a:null),"dialog-data":s(Z),onSuccess:x,onClosed:me},null,8,["dialog-type","is-show","dialog-data"]),l(je,{"is-show":s(P),"onUpdate:isShow":t[7]||(t[7]=a=>q(P)?P.value=a:null),"dialog-data":s(ee)},null,8,["is-show","dialog-data"])])])}}}),qt=Ge(it,[["__scopeId","data-v-b04062c2"]]);export{qt as default};
