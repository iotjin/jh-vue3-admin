import{D as Re,c as J,b as W,h as Ne,u as Te,F as Oe,G as Je,H as Ee,v as Ae,t as Ie,I as Me,g as Ye,J as Be,K as Fe}from"./element-plus-aadc362a.js";import{q as X}from"./@vueuse-1f405dae.js";import{d as ae,o as D,c as L,W as r,u as i,k as A,R as ne,r as Pe,_ as V,$,i as Ue,an as ze,a as f,P as g,ae as Z,F as Ve,aa as $e,O as R,U as N,Q as v,V as E,a1 as qe,X as Le,bh as Ke,bf as je}from"./@vue-e22e5611.js";import{_ as oe}from"./plugin-vueexport-helper-c27b6911.js";import{g as He,A as Qe}from"./addDialog-f3866023.js";import{g as ee,d as Ge,r as We}from"./user-e36aff2c.js";import Xe from"./assignRoleDialog-a536d879.js";import{u as q,w as Ze}from"./xlsx-f5126985.js";import"./lodash-es-d29772ce.js";import"./async-validator-dee29e8b.js";import"./dayjs-78f57161.js";import"./@intlify-999e9484.js";import"./source-map-7d7e1c08.js";import"./@element-plus-db57e607.js";import"./@ctrl-f8748455.js";import"./@sxzz-c75af06c.js";import"./escape-html-bdfaebd7.js";import"./normalize-wheel-es-ed76fb12.js";import"./index-2ede00d3.js";import"./pinia-32912ef6.js";import"./vue-demi-71ba0ef2.js";import"./vue-router-ff164504.js";import"./axios-4a70c6fc.js";import"./vue-i18n-01c42e63.js";import"./vue-f742e9c7.js";import"./js-cookie-edb2da2a.js";import"./nprogress-941844a1.js";import"./vite-plugin-mock-8bbc2346.js";import"./mockjs-3c670f17.js";import"./path-to-regexp-36ea9d8d.js";const et=(a,e,t,n)=>(a/=n/2,a<1?t/2*a*a+e:(a--,-t/2*(a*(a-2)-1)+e)),tt=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),at=a=>{document.documentElement.scrollTop=a,document.body.parentNode.scrollTop=a,document.body.scrollTop=a},nt=()=>document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop,te=(a,e,t)=>{const n=nt(),d=a-n,h=20;let c=0;e=typeof e>"u"?500:e;const p=function(){c+=h;const u=et(c,n,d,e);at(u),c<e?tt(p):t&&typeof t=="function"&&t()};p()},ot=ae({__name:"index",props:{total:{required:!0,type:Number,default:0},page:{type:Number,default:1},limit:{type:Number,default:20},pageSizes:{type:Array,default(){return[10,20,30,50]}},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0},autoScroll:{type:Boolean,default:!0},hidden:{type:Boolean,default:!1}},emits:["pagination","update:page","update:limit"],setup(a,{emit:e}){const t=a,n=X(t,"page",e),d=X(t,"limit",e);function h(p){n.value=1,e("pagination",{page:n,limit:p}),t.autoScroll&&te(0,800)}function c(p){n.value=p,e("pagination",{page:p,limit:t.limit}),t.autoScroll&&te(0,800)}return(p,u)=>{const m=Re;return D(),L("div",{class:ne("pagination "+{hidden:a.hidden})},[r(m,{"current-page":i(n),"onUpdate:currentPage":u[0]||(u[0]=w=>A(n)?n.value=w:null),"page-size":i(d),"onUpdate:pageSize":u[1]||(u[1]=w=>A(d)?d.value=w:null),background:a.background,layout:a.layout,"page-sizes":a.pageSizes,total:a.total,onSizeChange:h,onCurrentChange:c},null,8,["current-page","page-size","background","layout","page-sizes","total"])],2)}}});const lt=oe(ot,[["__scopeId","data-v-60d1e8b7"]]),st={Jh_timeStampToTime:j,Jh_convertTimeStamp:K,Jh_timestampToYMD:rt,Jh_isToday:it,Jh_getYearMonth:dt,Jh_getPrevYear:ut,Jh_getNextYear:ct,Jh_getPrevYearMonth:pt,Jh_getNextYearMonth:gt,Jh_compareTimes:yt,Jh_isBetweenTimes:_t,Jh_isBetweenTimesByCurrent:bt,Jh_isBetweenTimesByCurrentAndEndTime:wt,getEndTime:mt,startOfDay:ft,endOfDay:ht},Y=st;function j(a,e){if(arguments.length===0)return null;const t=e||"{y}-{m}-{d} {h}:{i}:{s}";let n;typeof a=="object"?console.log():((""+a).length===10&&(a=parseInt(a)*1e3),n=new Date(a));const d={y:n.getFullYear(),m:n.getMonth()+1,d:n.getDate(),h:n.getHours(),i:n.getMinutes(),s:n.getSeconds(),w:n.getDay()};return t.replace(/{(y|m|d|h|i|s|w)+}/g,(c,p)=>{let u=d[p];return p==="w"?["日","一","二","三","四","五","六"][u]:(c.length>0&&u<10&&(u="0"+u),u||0)})}function K(a){let e=a.replace(/-|\./g,"/");return e=e.replace(/年/g,"/"),e=e.replace(/月/g,"/"),e=e.replace(/日/g,""),e.length===4&&(e=e+"/01/01 00:00:00"),e.length===7&&(e=e+"/01 00:00:00"),e.length===10&&(e=e+" 00:00:00"),e.length===16&&(e=e+":00"),Date.parse(e)}function rt(a,e){var t=["Y","M","D","h","m","s"],n=[],d=new Date(parseInt(a)),h=d.getFullYear(),c=d.getMonth()+1,p=d.getDate(),u=d.getHours(),m=d.getMinutes(),w=d.getSeconds();n.push(h),n.push(c<10?"0"+c:c),n.push(p<10?"0"+p:p),n.push(u<10?"0"+u:u),n.push(m<10?"0"+m:m),n.push(w<10?"0"+w:w);for(var T in n)e=e.replace(t[T],n[T]);return e}function it(a){let e=a.replace(/-/g,"");e=e.substring(0,8);var t=new Date().getTime();return t=j(t,"{y}{m}{d}"),e===t}function dt(){const a=Date.parse(new Date);return j(a,"{y}-{m}")}function ut(a){let e=a.substring(0,4);e=parseInt(e),e=e-1;const t=a.substring(4,5);let n="";return t==="年"?n=e+"年":n=e+t,n}function ct(a){let e=a.substring(0,4);e=parseInt(e),e=e+1;const t=a.substring(4,5);let n="";return t==="年"?n=e+"年":n=e+t,n}function pt(a){let e=a.substring(0,4),t=a.substring(5,7);e=parseInt(e),t=parseInt(t),t=t-1,t===0&&(e=e-1,t=12),t<10&&(t="0"+t);const n=a.substring(4,5);let d="";return n==="年"?d=e+"年"+t+"月":d=e+n+t,d}function gt(a){let e=a.substring(0,4),t=a.substring(5,7);e=parseInt(e),t=parseInt(t),t=t+1,t===13&&(e=e+1,t=1),t<10&&(t="0"+t);const n=a.substring(4,5);let d="";return n==="年"?d=e+"年"+t+"月":d=e+n+t,d}function mt(a){var e=new Date(a).getFullYear(),t=new Date(a).getMonth()+1,n=new Date(a).getDate(),d=new Date,h=new Date(new Date(a).toLocaleDateString()),c=h.getTime()-d.getTime(),p=parseInt(c/1e3),u=Math.floor(p/(60*60*24)),m=Math.floor((p-u*24*60*60)/3600),w=Math.floor((p-u*24*60*60-m*3600)/60),T=Math.floor(p-u*60*60*24-m*60*60-w*60);return`距离${e}年${t}月${n}日还有${u}天${m}小时${w}分${T}秒`}function ft(a){return a?a.substr(0,10)+" 00:00:00":""}function ht(a){return a?a.substr(0,10)+" 23:59:59":""}function _t(a,e,t){return a=a.replace(/-/g,"/"),e=e.replace(/-/g,"/"),t=t.replace(/-/g,"/"),a=new Date(a),e=new Date(e),t=new Date(t),e<=a&&a<=t}function bt(a,e){a=a.replace(/-/g,"/"),e=e.replace(/-/g,"/"),a=new Date(a),e=new Date(e);const t=new Date;return a<=t&&t<=e}function wt(a,e){const t=new Date;return a=a.replace(/-/g,"/"),e=e.replace(/-/g,"/"),a=new Date(a),e=new Date(e),t<=a&&a<=e}function yt(a,e){const t=K(a),n=K(e);return t>n}function vt(a,e,t=[],n="Excel.xlsx",d="Sheet"){let h=new Array;if(!Array.isArray(a))return console.warn("dataList is not an array type");h=a.map(u=>e.map(m=>u[m])),t.length>0?h.splice(0,0,t):h.splice(0,0,e);const c=q.aoa_to_sheet(h),p=q.book_new();q.book_append_sheet(p,c,d),Ze(p,n)}const B=a=>(Ke("data-v-25cea375"),a=a(),je(),a),Dt={class:"bs-page-body"},St=B(()=>f("span",{class:"bs-form-label",style:{width:"80px"}},[f("span",{class:"icon"},"姓名:")],-1)),xt=B(()=>f("span",{class:"bs-form-label"},[f("span",{class:"icon"},"员工编号:")],-1)),Ct=B(()=>f("span",{class:"bs-form-label",style:{width:"80px"}},[f("span",{class:"icon"},"部门:")],-1)),kt=B(()=>f("span",{class:"bs-form-label",style:{width:"100px"}},[f("span",{class:"icon"},"创建时间:")],-1)),Rt={class:"bs-page-table"},Nt={class:"bs-table-btns"},Tt=["onClick"],Ot={style:{color:"#00a0e9","text-decoration":"underline"}},Jt={class:"bs-tooltip-text"},Et=ae({__name:"index",setup(a){const e=Pe(),t=V({tableTotal:0,tableLoading:!1,tableData:[],queryParams:{page:1,limit:10,startDate:"",endDate:"",name:"",userNumber:"",deptId:""},dateRange:[],selectedRows:[]}),{tableTotal:n,tableLoading:d,tableData:h,queryParams:c,dateRange:p,selectedRows:u}=$(t),m=V({deptOptions:[],levelOptions:[]}),{deptOptions:w,levelOptions:T}=$(m),_=V({dialogType:"add",isShowDialog:!1,dialogFormData:{},isShowDialogAssignRole:!1,assignRoleUserData:{}}),{dialogType:le,isShowDialog:F,dialogFormData:se,isShowDialogAssignRole:P,assignRoleUserData:re}=$(_);Ue(()=>{ie(),O()});const ie=()=>{He().then(o=>{o.code===2e4?(m.deptOptions=o.data.dept,m.levelOptions=o.data.level):J.error(o.msg)})},O=()=>{var o=JSON.parse(JSON.stringify(t.queryParams));o.startDate=t.dateRange?Y.startOfDay(t.dateRange[0]):"",o.endDate=t.dateRange?Y.endOfDay(t.dateRange[1]):"",console.log(JSON.stringify(o)),t.tableLoading=!0,ee(o).then(l=>{t.tableLoading=!1,l.code===2e4?(t.tableData=l.data,t.tableTotal=l.total):J.error(l.msg)}).catch(l=>{t.tableLoading=!1,console.log(JSON.stringify(l))})},U=()=>{t.queryParams.page=1,O()},I=o=>!o.loginName.toLowerCase().includes("admin"),de=o=>{t.selectedRows=o},M=(o,l)=>{const b=l.findIndex(S=>S.value===o);if(b!==-1)return l[b].label},ue=o=>o.status==="0"?"#E6A23C":"#67C23A",ce=()=>{_.dialogType="add",_.dialogFormData={},_.isShowDialog=!0},H=o=>{const l=JSON.parse(JSON.stringify(o&&o.id?o:t.selectedRows[0]));_.dialogType="edit",_.dialogFormData=l,_.isShowDialog=!0},pe=o=>{const l=JSON.parse(JSON.stringify(o&&o.id?o:t.selectedRows[0]));_.dialogType="look",_.dialogFormData=l,_.isShowDialog=!0},Q=o=>{var l="";o&&o.id?l=o.name:l=t.selectedRows.map(b=>b.name).join(","),W.confirm(`确定要删除用户 ${l} ，此操作将永久删除, 是否继续?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var b={ids:[]};if(o&&o.id)b.ids=[o.id];else{const S=t.selectedRows.map(x=>x.id);b.ids=S.join(",")}ge(b)})},ge=o=>{Ge(o).then(l=>{l.code===2e4?(J.success("删除成功!"),O()):J.error(l.msg)})},me=()=>{if(t.selectedRows.length===0){var o=JSON.parse(JSON.stringify(t.queryParams));o.startDate=t.dateRange?Y.startOfDay(t.dateRange[0]):"",o.endDate=t.dateRange?Y.endOfDay(t.dateRange[1]):"",o.page=0,o.limit=1e3,console.log(JSON.stringify(o)),ee(o).then(l=>{const{data:b}=l;G(b)})}else G(t.selectedRows)},G=o=>{var l=o;l.forEach(x=>{x.deptName=M(x.deptId,m.deptOptions),x.statusText=x.status==="0"?"停用":"启用",x.levelName=M(x.level,m.levelOptions)}),vt(l,["name","loginName","userNumber","deptName","statusText","userExpiryDate","levelName","notes","phone"],["姓名","用户名","员工编号","部门","状态","用户有效期至","级别","备注","手机号"],"用户数据.xlsx")},fe=()=>{_.assignRoleUserData=JSON.parse(JSON.stringify(t.selectedRows[0])),_.isShowDialogAssignRole=!0},he=o=>{_.dialogType="look",_.dialogFormData=JSON.parse(JSON.stringify(o)),_.isShowDialog=!0},_e=o=>{W.confirm(`确定要重置 ${o.name} 的密码, 是否继续 ?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const l={id:o.id};be(l)})},be=o=>{console.log(JSON.stringify(o)),We(o).then(l=>{l.code===2e4?(J.success("重置密码成功!"),O()):J.error(l.msg)})},we=()=>{e.value.clearSelection()};return(o,l)=>{const b=Ne,S=Te,x=Oe,ye=Je,ve=Ee,C=Ae,De=Ie,y=Me,Se=Ye,xe=Be,Ce=lt,k=ze("hasPerm"),ke=Fe;return D(),L("div",null,[f("div",Dt,[r(De,{inline:!0,model:i(c),class:"bs-form-search mt10"},{default:g(()=>[r(S,null,{default:g(()=>[St,r(b,{modelValue:i(c).name,"onUpdate:modelValue":l[0]||(l[0]=s=>i(c).name=s),maxlength:"20",placeholder:"请输入姓名",clearable:"",onKeyup:Z(U,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1}),r(S,null,{default:g(()=>[xt,r(b,{modelValue:i(c).userNumber,"onUpdate:modelValue":l[1]||(l[1]=s=>i(c).userNumber=s),maxlength:"20",placeholder:"请输入员工编号",clearable:"",onKeyup:Z(U,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1}),r(S,null,{default:g(()=>[Ct,r(ye,{modelValue:i(c).deptId,"onUpdate:modelValue":l[2]||(l[2]=s=>i(c).deptId=s),placeholder:"请选择",filterable:"",clearable:""},{default:g(()=>[(D(!0),L(Ve,null,$e(i(w),s=>(D(),R(x,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(S,null,{default:g(()=>[kt,r(ve,{modelValue:i(p),"onUpdate:modelValue":l[3]||(l[3]=s=>A(p)?p.value=s:null),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",format:"YYYY年MM月DD日"},null,8,["modelValue"])]),_:1}),r(S,null,{default:g(()=>[r(C,{class:"bs-form-btn",type:"primary",onClick:U},{default:g(()=>[N("查询")]),_:1})]),_:1})]),_:1},8,["model"]),f("div",Rt,[f("div",Nt,[v((D(),R(C,{type:"primary",icon:"i-ep-plus",onClick:ce},{default:g(()=>[N(" 新增 ")]),_:1})),[[k,["user-add"]]]),v((D(),R(C,{type:"primary",icon:"i-ep-edit",disabled:i(u).length!==1,onClick:H},{default:g(()=>[N(" 编辑 ")]),_:1},8,["disabled"])),[[k,["user-edit"]]]),v((D(),R(C,{type:"primary",icon:"i-ep-search",disabled:i(u).length!==1,onClick:pe},{default:g(()=>[N(" 查看 ")]),_:1},8,["disabled"])),[[k,["user-look"]]]),v((D(),R(C,{type:"warning",icon:"i-ep-download",onClick:me},{default:g(()=>[N(" 导出 ")]),_:1})),[[k,["user-export"]]]),v((D(),R(C,{type:"danger",icon:"i-ep-delete",disabled:i(u).length==0,onClick:Q},{default:g(()=>[N(" 删除 ")]),_:1},8,["disabled"])),[[k,["user-delete"]]]),v((D(),R(C,{type:"warning",icon:"i-ep-setting",disabled:i(u).length!==1,onClick:fe},{default:g(()=>[N(" 角色分配 ")]),_:1},8,["disabled"])),[[k,["user-assign"]]])]),v((D(),R(xe,{ref_key:"tableRef",ref:e,class:"bs-table",data:i(h),stripe:!0,"header-cell-style":{textAlign:"center"},"cell-style":{textAlign:"center"},onSelectionChange:de},{default:g(()=>[r(y,{prop:"number",type:"index",label:"序号","min-width":"60"}),r(y,{type:"selection",width:"55",selectable:I}),r(y,{label:"姓名","min-width":"100"},{default:g(s=>[f("span",{onClick:z=>he(s.row)},[f("a",Ot,E(s.row.name),1)],8,Tt)]),_:1}),r(y,{prop:"loginName",label:"用户名","min-width":"120"}),r(y,{prop:"userNumber",label:"员工编号","min-width":"120",sortable:""}),r(y,{label:"部门","min-width":"130"},{default:g(s=>[f("div",null,E(M(s.row.deptId,i(w))),1)]),_:1}),r(y,{label:"状态"},{default:g(s=>[f("div",{style:qe({background:ue(s.row)}),class:"tagClass"},E(s.row.status==="0"?"停用":"启用"),5)]),_:1}),r(y,{prop:"userExpiryDate",label:"用户有效期至",sortable:"","min-width":"140"}),r(y,{label:"级别","min-width":"100"},{default:g(s=>[f("div",{class:ne(s.row.level=="1"?"b-tag-success":s.row.level=="2"?"b-tag-warning":"b-tag-error")},E(M(s.row.level,i(T))),3)]),_:1}),r(y,{prop:"phone",label:"手机号","min-width":"120"}),r(y,{label:"备注","min-width":"100"},{default:g(s=>[r(Se,{"visible-arrow":!1,effect:"light",content:s.row.notes,placement:"bottom"},{default:g(()=>[f("span",Jt,E(s.row.notes),1)]),_:2},1032,["content"])]),_:1}),r(y,{fixed:"right",label:"操作",width:"180"},{default:g(s=>[v(r(C,{size:"small",icon:"i-ep-edit",disabled:!I(s.row),onClick:z=>H(s.row)},null,8,["disabled","onClick"]),[[k,["user-edit"]]]),v(r(C,{size:"small",icon:"i-ep-delete",type:"danger",disabled:!I(s.row),onClick:z=>Q(s.row)},null,8,["disabled","onClick"]),[[k,["user-delete"]]]),v(r(C,{size:"small",icon:"i-ep-refresh-left",type:"danger",disabled:!I(s.row),onClick:z=>_e(s.row)},null,8,["disabled","onClick"]),[[k,["user-resetPwd"]]])]),_:1})]),_:1},8,["data"])),[[ke,i(d)]]),v(r(Ce,{total:i(n),page:i(c).page,"onUpdate:page":l[4]||(l[4]=s=>i(c).page=s),limit:i(c).limit,"onUpdate:limit":l[5]||(l[5]=s=>i(c).limit=s),onPagination:O},null,8,["total","page","limit"]),[[Le,i(n)>0]])]),r(Qe,{"dialog-type":i(le),"is-show":i(F),"onUpdate:isShow":l[6]||(l[6]=s=>A(F)?F.value=s:null),"dialog-data":i(se),onSuccess:O,onClosed:we},null,8,["dialog-type","is-show","dialog-data"]),r(Xe,{"is-show":i(P),"onUpdate:isShow":l[7]||(l[7]=s=>A(P)?P.value=s:null),"dialog-data":i(re)},null,8,["is-show","dialog-data"])])])}}});const da=oe(Et,[["__scopeId","data-v-25cea375"]]);export{da as default};
