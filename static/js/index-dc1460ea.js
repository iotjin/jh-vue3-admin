import{c as R,b as j,h as he,v as ve,G as De,H as Se,I as xe,w as ke,u as Re,J as Ce,g as Ne,K as Oe,L as Ee}from"./element-plus-52aa6b43.js";import{_ as Te}from"./index-dd648514.js";import{d as Ae,r as Je,$ as B,a0 as F,i as Ve,ao as Ie,o as f,c as G,a as i,X as l,Q as n,u as s,af as H,F as Ue,ab as Le,P as w,l as q,V as v,R as m,W as N,a2 as Pe,S as Be,Y as Fe,bh as qe,bf as Ye}from"./@vue-7d0fc2b4.js";import{g as Me,A as $e}from"./addDialog-098025ca.js";import{g as Q,d as Ke,r as ze}from"./user-8ac8884d.js";import je from"./assignRoleDialog-7745ca0c.js";import{T as A}from"./timeUtils-a990067c.js";import{u as Y,w as Ge}from"./xlsx-f5126985.js";import{_ as He}from"./plugin-vueexport-helper-c27b6911.js";import"./lodash-es-d29772ce.js";import"./async-validator-dee29e8b.js";import"./@vueuse-d1e6df39.js";import"./dayjs-78f57161.js";import"./@intlify-999e9484.js";import"./source-map-7d7e1c08.js";import"./@element-plus-975622b8.js";import"./@ctrl-f8748455.js";import"./@sxzz-c75af06c.js";import"./escape-html-bdfaebd7.js";import"./normalize-wheel-es-ed76fb12.js";import"./dict-2e6d1e8e.js";import"./index-1ba5e46f.js";import"./pinia-4649f5ad.js";import"./vue-demi-71ba0ef2.js";import"./vue-router-98b533fa.js";import"./axios-4a70c6fc.js";import"./vue-i18n-625cf0a6.js";import"./vue-ff9293da.js";import"./js-cookie-edb2da2a.js";import"./nprogress-941844a1.js";import"./mockjs-3c670f17.js";import"./vite-plugin-mock-8bbc2346.js";import"./path-to-regexp-36ea9d8d.js";import"./role-d4939405.js";function Qe(y,C,o=[],O="Excel.xlsx",V="Sheet"){let D=new Array;if(!Array.isArray(y))return console.warn("dataList is not an array type");D=y.map(x=>C.map(h=>x[h])),o.length>0?D.splice(0,0,o):D.splice(0,0,C);const p=Y.aoa_to_sheet(D),S=Y.book_new();Y.book_append_sheet(S,p,V),Ge(S,O)}const J=y=>(qe("data-v-b04062c2"),y=y(),Ye(),y),We={class:"bs-page-body"},Xe=J(()=>i("span",{class:"bs-form-label",style:{width:"80px"}},[i("span",{class:"icon"},"姓名:")],-1)),Ze=J(()=>i("span",{class:"bs-form-label"},[i("span",{class:"icon"},"员工编号:")],-1)),et=J(()=>i("span",{class:"bs-form-label",style:{width:"80px"}},[i("span",{class:"icon"},"部门:")],-1)),tt=J(()=>i("span",{class:"bs-form-label",style:{width:"100px"}},[i("span",{class:"icon"},"创建时间:")],-1)),at={class:"bs-page-table"},lt={class:"bs-table-btns"},ot=["onClick"],st={style:{color:"#00a0e9","text-decoration":"underline"}},nt={class:"bs-tooltip-text"},it=Ae({__name:"index",setup(y){const C=Je(),o=B({tableTotal:0,tableLoading:!1,tableData:[],queryParams:{page:1,limit:10,startDate:"",endDate:"",name:"",userNumber:"",deptId:""},dateRange:[],selectedRows:[]}),{tableTotal:O,tableLoading:V,tableData:D,queryParams:p,dateRange:S,selectedRows:x}=F(o),h=B({deptOptions:[],levelOptions:[]}),{deptOptions:M,levelOptions:W}=F(h),d=B({isShowDialog:!1,dialogType:"add",dialogFormData:{},isShowDialogAssignRole:!1,assignRoleUserData:{}}),{isShowDialog:I,dialogType:X,dialogFormData:Z,isShowDialogAssignRole:U,assignRoleUserData:ee}=F(d);Ve(()=>{te(),k()});const te=()=>{Me().then(e=>{e.code===2e4?(h.deptOptions=e.data.dept,h.levelOptions=e.data.level):R.warning(e.msg)})},k=()=>{var e=JSON.parse(JSON.stringify(o.queryParams));e.startDate=o.dateRange?A.startOfDay(o.dateRange[0]):"",e.endDate=o.dateRange?A.endOfDay(o.dateRange[1]):"",console.log(JSON.stringify(e)),o.tableLoading=!0,Q(e).then(t=>{o.tableLoading=!1,t.code===2e4?(o.tableData=t.data,o.tableTotal=t.total):R.warning(t.msg)}).catch(t=>{o.tableLoading=!1,console.log(JSON.stringify(t))})},L=()=>{o.queryParams.page=1,k()},E=e=>!e.loginName.toLowerCase().includes("admin"),ae=e=>{o.selectedRows=e},T=(e,t)=>{const r=t.findIndex(u=>u.value===e);if(r!==-1)return t[r].label},le=e=>e.status==="0"?"#E6A23C":"#67C23A",oe=()=>{d.dialogType="add",d.dialogFormData={},d.isShowDialog=!0},$=e=>{const t=JSON.parse(JSON.stringify(e&&e.id?e:o.selectedRows[0]));d.dialogType="edit",d.dialogFormData=t,d.isShowDialog=!0},se=e=>{const t=JSON.parse(JSON.stringify(e&&e.id?e:o.selectedRows[0]));d.dialogType="look",d.dialogFormData=t,d.isShowDialog=!0},K=e=>{var t="";e&&e.id?t=e.name:t=o.selectedRows.map(r=>r.name).join(","),j.confirm(`确定要删除用户 ${t} ，此操作将永久删除, 是否继续?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var r={ids:[]};if(e&&e.id)r.ids=[e.id];else{const u=o.selectedRows.map(g=>g.id);r.ids=u}ne(r)})},ne=e=>{Ke(e).then(t=>{t.code===2e4?(R.success("删除成功!"),k()):R.warning(t.msg)})},ie=()=>{if(o.selectedRows.length===0){var e=JSON.parse(JSON.stringify(o.queryParams));e.startDate=o.dateRange?A.startOfDay(o.dateRange[0]):"",e.endDate=o.dateRange?A.endOfDay(o.dateRange[1]):"",e.page=0,e.limit=1e3,console.log(JSON.stringify(e)),Q(e).then(t=>{const{data:r}=t;z(r)})}else z(o.selectedRows)},z=e=>{var t=e;t.forEach(g=>{g.deptName=T(g.deptId,h.deptOptions),g.statusText=g.status==="0"?"停用":"启用",g.levelName=T(g.level,h.levelOptions)}),Qe(t,["name","loginName","userNumber","deptName","statusText","userExpiryDate","levelName","notes","phone"],["姓名","用户名","员工编号","部门","状态","用户有效期至","级别","备注","手机号"],"用户数据.xlsx")},de=()=>{d.assignRoleUserData=JSON.parse(JSON.stringify(o.selectedRows[0])),d.isShowDialogAssignRole=!0},re=e=>{d.dialogType="look",d.dialogFormData=JSON.parse(JSON.stringify(e)),d.isShowDialog=!0},pe=e=>{j.confirm(`确定要重置 ${e.name} 的密码, 是否继续 ?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const t={id:e.id};ce(t)})},ce=e=>{console.log(JSON.stringify(e)),ze(e).then(t=>{t.code===2e4?(R.success("重置密码成功!"),k()):R.warning(t.msg)})},me=()=>{C.value.clearSelection()};return(e,t)=>{const r=he,u=ve,g=De,ue=Se,ge=xe,b=ke,be=Re,c=Ce,fe=Ne,_e=Oe,we=Te,_=Ie("hasPerm"),ye=Ee;return f(),G("div",null,[i("div",We,[l(be,{inline:!0,model:s(p),class:"bs-form-search mt10"},{default:n(()=>[l(u,null,{default:n(()=>[Xe,l(r,{modelValue:s(p).name,"onUpdate:modelValue":t[0]||(t[0]=a=>s(p).name=a),maxlength:"20",placeholder:"请输入姓名",clearable:"",onKeyup:H(L,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1}),l(u,null,{default:n(()=>[Ze,l(r,{modelValue:s(p).userNumber,"onUpdate:modelValue":t[1]||(t[1]=a=>s(p).userNumber=a),maxlength:"20",placeholder:"请输入员工编号",clearable:"",onKeyup:H(L,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1}),l(u,null,{default:n(()=>[et,l(ue,{modelValue:s(p).deptId,"onUpdate:modelValue":t[2]||(t[2]=a=>s(p).deptId=a),placeholder:"请选择",filterable:"",clearable:""},{default:n(()=>[(f(!0),G(Ue,null,Le(s(M),a=>(f(),w(g,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,null,{default:n(()=>[tt,l(ge,{modelValue:s(S),"onUpdate:modelValue":t[3]||(t[3]=a=>q(S)?S.value=a:null),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",format:"YYYY年MM月DD日"},null,8,["modelValue"])]),_:1}),l(u,null,{default:n(()=>[l(b,{class:"bs-form-btn",type:"primary",onClick:L},{default:n(()=>[v("查询")]),_:1})]),_:1})]),_:1},8,["model"]),i("div",at,[i("div",lt,[m((f(),w(b,{type:"primary",icon:"i-ep-plus",onClick:oe},{default:n(()=>[v(" 新增 ")]),_:1})),[[_,["user-add"]]]),m((f(),w(b,{type:"primary",icon:"i-ep-edit",disabled:s(x).length!==1,onClick:$},{default:n(()=>[v(" 编辑 ")]),_:1},8,["disabled"])),[[_,["user-edit"]]]),m((f(),w(b,{type:"primary",icon:"i-ep-search",disabled:s(x).length!==1,onClick:se},{default:n(()=>[v(" 查看 ")]),_:1},8,["disabled"])),[[_,["user-look"]]]),m((f(),w(b,{type:"warning",icon:"i-ep-download",onClick:ie},{default:n(()=>[v(" 导出 ")]),_:1})),[[_,["user-export"]]]),m((f(),w(b,{type:"danger",icon:"i-ep-delete",disabled:s(x).length==0,onClick:K},{default:n(()=>[v(" 删除 ")]),_:1},8,["disabled"])),[[_,["user-delete"]]]),m((f(),w(b,{type:"warning",icon:"i-ep-setting",disabled:s(x).length!==1,onClick:de},{default:n(()=>[v(" 角色分配 ")]),_:1},8,["disabled"])),[[_,["user-assign"]]])]),m((f(),w(_e,{ref_key:"tableRef",ref:C,class:"bs-table",data:s(D),stripe:!0,"header-cell-style":{textAlign:"center"},"cell-style":{textAlign:"center"},onSelectionChange:ae},{default:n(()=>[l(c,{prop:"number",type:"index",label:"序号","min-width":"60"}),l(c,{type:"selection",width:"55",selectable:E}),l(c,{label:"姓名","min-width":"100"},{default:n(a=>[i("span",{onClick:P=>re(a.row)},[i("a",st,N(a.row.name),1)],8,ot)]),_:1}),l(c,{prop:"loginName",label:"用户名","min-width":"120"}),l(c,{prop:"userNumber",label:"员工编号","min-width":"120",sortable:""}),l(c,{label:"部门","min-width":"130"},{default:n(a=>[i("div",null,N(T(a.row.deptId,s(M))),1)]),_:1}),l(c,{label:"状态"},{default:n(a=>[i("div",{style:Pe({background:le(a.row)}),class:"tagClass"},N(a.row.status==="0"?"停用":"启用"),5)]),_:1}),l(c,{prop:"userExpiryDate",label:"用户有效期至",sortable:"","min-width":"140"}),l(c,{label:"级别","min-width":"100"},{default:n(a=>[i("div",{class:Be(a.row.level=="1"?"b-tag-success":a.row.level=="2"?"b-tag-warning":"b-tag-error")},N(T(a.row.level,s(W))),3)]),_:1}),l(c,{prop:"phone",label:"手机号","min-width":"120"}),l(c,{label:"备注","min-width":"100"},{default:n(a=>[l(fe,{"visible-arrow":!1,effect:"light",content:a.row.notes,placement:"bottom"},{default:n(()=>[i("span",nt,N(a.row.notes),1)]),_:2},1032,["content"])]),_:1}),l(c,{fixed:"right",label:"操作",width:"180"},{default:n(a=>[m(l(b,{size:"small",icon:"i-ep-edit",disabled:!E(a.row),onClick:P=>$(a.row)},null,8,["disabled","onClick"]),[[_,["user-edit"]]]),m(l(b,{size:"small",icon:"i-ep-delete",type:"danger",disabled:!E(a.row),onClick:P=>K(a.row)},null,8,["disabled","onClick"]),[[_,["user-delete"]]]),m(l(b,{size:"small",icon:"i-ep-refresh-left",type:"danger",disabled:!E(a.row),onClick:P=>pe(a.row)},null,8,["disabled","onClick"]),[[_,["user-resetPwd"]]])]),_:1})]),_:1},8,["data"])),[[ye,s(V)]]),m(l(we,{total:s(O),page:s(p).page,"onUpdate:page":t[4]||(t[4]=a=>s(p).page=a),limit:s(p).limit,"onUpdate:limit":t[5]||(t[5]=a=>s(p).limit=a),onPagination:k},null,8,["total","page","limit"]),[[Fe,s(O)>0]])]),l($e,{"dialog-type":s(X),"is-show":s(I),"onUpdate:isShow":t[6]||(t[6]=a=>q(I)?I.value=a:null),"dialog-data":s(Z),onSuccess:k,onClosed:me},null,8,["dialog-type","is-show","dialog-data"]),l(je,{"is-show":s(U),"onUpdate:isShow":t[7]||(t[7]=a=>q(U)?U.value=a:null),"dialog-data":s(ee)},null,8,["is-show","dialog-data"])])])}}});const Yt=He(it,[["__scopeId","data-v-b04062c2"]]);export{Yt as default};
